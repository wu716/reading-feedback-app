<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-talk ÂÜÖÂøÉÂØπËØùÁ≥ªÁªü</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #333;
            margin: 0;
            padding: 0;
            position: relative;
        }

        /* ËÉåÊôØÁ∫πÁêÜ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* ÂæÆÂ¶ôÁöÑÂÖâÁÇπÊïàÊûú */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,0.3), transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.2), transparent),
                radial-gradient(1px 1px at 90px 40px, rgba(255,255,255,0.4), transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.3), transparent);
            background-repeat: repeat;
            background-size: 150px 100px;
            pointer-events: none;
            z-index: -1;
            animation: sparkle 20s linear infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }
        
        /* È°∂ÈÉ®ÂØºËà™Ê†èÊ†∑Âºè */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .app-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
            font-weight: 700;
        }
        
        .app-header .user-info {
            position: static;
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            display: none;
        }
        
        .app-header .user-info.show {
            display: block;
        }
        
        /* ‰æßËæπÂØºËà™Ê†èÊ†∑Âºè */
        .app-sidebar {
            position: fixed;
            left: 0;
            top: 70px;
            width: 240px;
            height: calc(100vh - 70px);
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            z-index: 999;
            overflow-y: auto;
        }
        
        .sidebar-nav {
            padding: 20px 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            gap: 12px;
        }
        
        .nav-item:hover {
            background: #f8f9fa;
            color: #667eea;
        }
        
        .nav-item.active {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.1), transparent);
            border-left: 4px solid #667eea;
            color: #667eea;
            font-weight: 600;
            padding-left: 21px;
        }
        
        .nav-icon {
            font-size: 1.4rem;
            width: 28px;
            text-align: center;
        }
        
        .nav-text {
            font-size: 0.95rem;
        }
        
        .nav-divider {
            height: 1px;
            background: #e1e5e9;
            margin: 15px 20px;
        }
        
        /* ‰∏ªÂÜÖÂÆπÂå∫ÂüüÊ†∑Âºè */
        .app-main {
            margin-left: 240px;
            margin-top: 70px;
            padding: 30px;
            min-height: calc(100vh - 70px);
            background: #f5f7fa;
        }
        
        .content-section {
            display: none;
            opacity: 0;
            animation: fadeInUp 0.4s ease;
            transition: opacity 0.3s ease-in;
        }
        
        .content-section.active {
            display: block;
            opacity: 1;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .section-header {
            margin-bottom: 30px;
        }
        
        .section-header h1 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .section-header p {
            color: #666;
            font-size: 1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .user-info {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            display: none;
        }
        
        .user-info.show {
            display: block;
        }
        
        .user-info .user-email {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* ÁôªÂΩïÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .auth-modal.hidden {
            display: none;
        }
        
        .auth-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            width: 400px;
            max-width: 90vw;
            position: relative;
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-header h2 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }
        
        .auth-header p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            color: #666;
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            font-weight: 600;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .password-hint {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }
        
        .auth-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .auth-btn:hover {
            transform: translateY(-2px);
        }
        
        .auth-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }
        
        /* Ë°åÂä®È°πÊ†∑Âºè */
        .action-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }
        
        .action-item h3 {
            margin-bottom: 10px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-todo {
            background: #ffeaa7;
            color: #d63031;
        }
        
        .status-in_progress {
            background: #74b9ff;
            color: white;
        }
        
        .status-done {
            background: #00b894;
            color: white;
        }
        
        .action-tags {
            margin-top: 10px;
        }
        
        .tag {
            display: inline-block;
            background: #f8f9fa;
            color: #495057;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-right: 8px;
            margin-bottom: 4px;
        }
        
        .action-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-complete {
            background: #00b894;
            color: white;
        }
        
        .btn-complete:hover {
            background: #00a085;
        }
        
        .btn-complete:disabled {
            background: #ddd;
            cursor: not-allowed;
        }
        
        .btn-log {
            background: #74b9ff;
            color: white;
        }
        
        .btn-log:hover {
            background: #0984e3;
        }
        
        /* Ë°åÂä®Á±ªÂûãÁ≠õÈÄâÊåâÈíÆÊ†∑Âºè */
        .action-type-filter {
            padding: 8px 16px;
            border: 2px solid #e1e5e9;
            background: white;
            color: #666;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .action-type-filter:hover {
            border-color: #667eea;
            color: #667eea;
        }
        
        .action-type-filter.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }
        
        /* ÂÆûË∑µËÆ∞ÂΩïÊ®°ÊÄÅÊ°Ü */
        .practice-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            backdrop-filter: blur(5px);
        }
        
        .practice-modal.hidden {
            display: none;
        }
        
        .practice-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            width: 500px;
            max-width: 90vw;
            position: relative;
        }
        
        .practice-header h3 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .rating-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .rating-stars {
            display: flex;
            gap: 5px;
        }
        
        .star {
            font-size: 1.5rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .star.active {
            color: #ffd700;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ‰∏™‰∫∫‰∏≠ÂøÉÊ†∑Âºè */
        .user-detail {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 0;
        }
        
        .user-detail label {
            font-weight: 600;
            color: #555;
            min-width: 60px;
            margin-right: 10px;
        }
        
        .user-detail span {
            color: #333;
            flex: 1;
        }
        
        .setting-item {
            margin-bottom: 12px;
            padding: 8px 0;
        }
        
        .setting-item label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            color: #555;
        }
        
        .setting-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .setting-item input[type="checkbox"]:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .reminder-subsection {
            border-left: 2px solid #e0e0e0;
            padding-left: 15px;
        }

        .reminder-subsection h5 {
            margin-top: 0;
            margin-bottom: 8px;
            color: #667eea;
            font-weight: 600;
        }
        
        .actions-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .action-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .action-item h3 {
            color: #333;
            margin-bottom: 8px;
        }
        
        .action-item p {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .action-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .tag {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-todo {
            background: #ffeaa7;
            color: #d63031;
        }
        
        .status-in-progress {
            background: #74b9ff;
            color: white;
        }
        
        .status-done {
            background: #00b894;
            color: white;
        }
        
        .dashboard {
            grid-column: 1 / -1;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .success {
            background: #51cf66;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        /* Êó∂Èó¥ÁÆ°ÁêÜËÆæÁΩÆÊ†∑Âºè */
        .time-management-settings {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row:last-child {
            margin-bottom: 0;
        }
        
        .form-col {
            flex: 1;
        }
        
        .form-col label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }
        
        .form-col input,
        .form-col select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-col input:focus,
        .form-col select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        /* È¶ñÈ°µ‰ª™Ë°®ÊùøÊ†∑Âºè */
        .homepage-dashboard {
            margin-bottom: 30px;
        }

        .dashboard-row {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .dashboard-row:last-child {
            margin-bottom: 0;
        }

        .widget-card {
            background: linear-gradient(135deg, #ffffff 0%, #f0f4ff 30%, #fff0f5 70%, #ffffff 100%);
            border: 1px solid rgba(102, 126, 234, 0.08);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.08),
                0 2px 8px rgba(0,0,0,0.04),
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -1px 0 rgba(102, 126, 234, 0.05);
            transition: all 0.3s ease;
            animation: fadeInUp 0.6s ease-out;
            position: relative;
            overflow: hidden;
        }

        /* ÂÖâÊôïÁ∫πÁêÜÊïàÊûú */
        .widget-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(255, 99, 132, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(102, 126, 234, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.02) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        /* Á°Æ‰øùÂÜÖÂÆπÂú®ÂÖâÊôï‰πã‰∏ä */
        .widget-card > * {
            position: relative;
            z-index: 2;
        }

        /* ‰∏∫‰∏çÂêåË°åÁöÑÂç°ÁâáÊ∑ªÂä†‰∏çÂêåÁöÑÂä®ÁîªÂª∂Ëøü */
        .dashboard-row:nth-child(1) .widget-card {
            animation-delay: 0.1s;
        }

        .dashboard-row:nth-child(2) .widget-card {
            animation-delay: 0.2s;
        }

        .dashboard-row:nth-child(3) .widget-card {
            animation-delay: 0.3s;
        }

        /* ‰∏∫Âø´ÈÄüÊìç‰ΩúÊåâÈíÆÊ∑ªÂä†ÁâπÊÆäÁöÑÊÇ¨ÂÅúÊïàÊûú */
        .quick-action-btn {
            position: relative;
            overflow: hidden;
        }

        .quick-action-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
        }

        .quick-action-btn:hover::before {
            width: 200px;
            height: 200px;
        }

        /* ‰∏∫ÁªüËÆ°Êï∞Â≠óÊ∑ªÂä†ËÆ°Êï∞Âä®Áîª */
        .stat-value, .stat-value-large {
            transition: all 0.3s ease;
        }

        .stat-value:hover, .stat-value-large:hover {
            transform: scale(1.1);
            color: #5a6fd8;
        }

        /* ‰∏∫ËøõÂ∫¶Êù°Ê∑ªÂä†Âä®Áîª */
        .progress-bar {
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .widget-card:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 12px 40px rgba(0,0,0,0.12),
                0 4px 12px rgba(0,0,0,0.08),
                inset 0 1px 0 rgba(255,255,255,0.95),
                inset 0 -1px 0 rgba(102, 126, 234, 0.08);
        }

        .widget-card:hover::before {
            background: 
                radial-gradient(circle at 20% 20%, rgba(255, 99, 132, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(102, 126, 234, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.03) 0%, transparent 50%);
            transition: background 0.3s ease;
        }

        .widget-card.full-width {
            grid-column: 1 / -1;
        }

        /* ‰∏∫‰∏çÂêåÁ±ªÂûãÁöÑÂç°ÁâáÊ∑ªÂä†Áã¨ÁâπÁöÑÊ∏êÂèòÊïàÊûú */
        .dashboard-row:nth-child(1) .widget-card:nth-child(1) {
            background: linear-gradient(135deg, #ffffff 0%, #f0f4ff 25%, #fff0f5 75%, #ffffff 100%);
        }

        .dashboard-row:nth-child(1) .widget-card:nth-child(2) {
            background: linear-gradient(135deg, #ffffff 0%, #fff0f5 25%, #f0f4ff 75%, #ffffff 100%);
        }

        .dashboard-row:nth-child(2) .widget-card:nth-child(1) {
            background: linear-gradient(135deg, #f0f4ff 0%, #ffffff 50%, #fff0f5 100%);
        }

        .dashboard-row:nth-child(2) .widget-card:nth-child(2) {
            background: linear-gradient(135deg, #fff0f5 0%, #ffffff 50%, #f0f4ff 100%);
        }

        .dashboard-row:nth-child(3) .widget-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 20%, #fff8f9 40%, #f8f9ff 60%, #fff8f9 80%, #ffffff 100%);
        }

        /* Âä®ÁîªÊïàÊûú */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        /* Ê∑ªÂä†Âä®ÁîªÁ±ª */
        .animate-fadeInUp {
            animation: fadeInUp 0.6s ease-out;
        }

        .animate-slideInLeft {
            animation: slideInLeft 0.6s ease-out;
        }

        .animate-slideInRight {
            animation: slideInRight 0.6s ease-out;
        }

        .animate-pulse {
            animation: pulse 2s infinite;
        }

        .animate-bounce {
            animation: bounce 1s infinite;
        }

        /* Â§©Ê∞î‰ø°ÊÅØÊ†∑Âºè */
        .weather-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
            padding: 8px 12px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 20px;
        }

        #weatherIcon {
            font-size: 1.2rem;
        }

        #weatherText {
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* ‰ªäÊó•ÂæÖÂäûÊ†∑Âºè */
        .today-todos {
            margin-top: 15px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        .todos-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .todo-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .todo-item:hover {
            background: #e9ecef;
        }

        .todo-text {
            font-size: 0.9rem;
            color: #333;
        }

        .todo-check {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .todo-check:hover {
            background: #5a6fd8;
            transform: scale(1.1);
        }

        /* ‰ªäÊó•Ê¶ÇËßàÊ†∑Âºè */
        .overview-stats {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            background: #e9ecef;
        }

        .stat-icon {
            font-size: 2rem;
            width: 50px;
            text-align: center;
        }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
        }

        .stat-progress {
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        /* Âø´ÈÄüÊìç‰ΩúÊ†∑Âºè */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px 15px;
            background: linear-gradient(135deg, #667eea 0%, #ff6b9d 50%, #764ba2 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .quick-action-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        .quick-action-btn > * {
            position: relative;
            z-index: 2;
        }

        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
            background: linear-gradient(135deg, #5a6fd8 0%, #ff5a8a 50%, #6a4190 100%);
        }

        .quick-action-btn:hover::after {
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.08) 0%, transparent 50%);
            transition: background 0.3s ease;
        }

        .action-icon {
            font-size: 1.5rem;
        }

        .action-text {
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* ‰∏™‰∫∫ÁªüËÆ°Ê†∑Âºè */
        .personal-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .stat-card {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .stat-icon-large {
            font-size: 2.5rem;
            width: 60px;
            text-align: center;
        }

        .stat-info {
            flex: 1;
        }

        .stat-value-large {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 4px;
        }

        .stat-label-large {
            font-size: 1rem;
            color: #666;
            margin-bottom: 4px;
        }

        .stat-trend {
            font-size: 0.9rem;
            color: #28a745;
            font-weight: 500;
        }

        .stat-chart {
            width: 80px;
            height: 40px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mini-chart {
            width: 60px;
            height: 20px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .mini-chart::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 2px,
                rgba(255,255,255,0.3) 2px,
                rgba(255,255,255,0.3) 4px
            );
        }

        /* Êó∂ÈíüÂç°ÁâáÁâπÊÆäÊ†∑Âºè */
        .clock-widget {
            position: relative;
            overflow: hidden;
        }

        /* Âä®ÊÄÅËÉåÊôØÂå∫Âüü */
        .dynamic-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(102, 126, 234, 0.05) 100%);
            z-index: 1;
            overflow: hidden;
        }

        /* ÊäΩË±°ÂΩ¢Áä∂Âä®Áîª */
        .abstract-shapes {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            opacity: 0.6;
            animation-duration: 8s;
            animation-iteration-count: infinite;
            animation-timing-function: ease-in-out;
        }

        .shape-1 {
            width: 20px;
            height: 20px;
            background: linear-gradient(45deg, #ff6b9d, #ffd93d);
            top: 15px;
            left: 20px;
            animation-name: float1;
        }

        .shape-2 {
            width: 15px;
            height: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            top: 25px;
            right: 30px;
            animation-name: float2;
            animation-delay: -2s;
        }

        .shape-3 {
            width: 25px;
            height: 25px;
            background: linear-gradient(45deg, #f093fb, #f5576c);
            top: 35px;
            left: 60%;
            animation-name: float3;
            animation-delay: -4s;
        }

        .shape-4 {
            width: 12px;
            height: 12px;
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            top: 20px;
            left: 40%;
            animation-name: float4;
            animation-delay: -6s;
        }

        /* ÊäΩË±°Âä®ÁîªÂÖ≥ÈîÆÂ∏ß */
        @keyframes float1 {
            0%, 100% { transform: translate(0, 0) rotate(0deg); opacity: 0.6; }
            25% { transform: translate(10px, -5px) rotate(90deg); opacity: 0.8; }
            50% { transform: translate(20px, 5px) rotate(180deg); opacity: 0.4; }
            75% { transform: translate(10px, 10px) rotate(270deg); opacity: 0.7; }
        }

        @keyframes float2 {
            0%, 100% { transform: translate(0, 0) rotate(0deg) scale(1); }
            33% { transform: translate(-15px, 8px) rotate(120deg) scale(1.2); }
            66% { transform: translate(-5px, -10px) rotate(240deg) scale(0.8); }
        }

        @keyframes float3 {
            0%, 100% { transform: translate(0, 0) skew(0deg); }
            50% { transform: translate(-8px, 12px) skew(15deg); }
        }

        @keyframes float4 {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(8px, -3px) rotate(45deg); }
            50% { transform: translate(-5px, 8px) rotate(90deg); }
            75% { transform: translate(-8px, -5px) rotate(135deg); }
        }

        /* Â§©Ê∞îÁõ∏ÂÖ≥Âä®Áîª */
        .sunny .shape-1 { background: linear-gradient(45deg, #ffd93d, #ff6b9d); }
        .sunny .shape-2 { background: linear-gradient(45deg, #ff9a9e, #fecfef); }
        .sunny .shape-3 { background: linear-gradient(45deg, #ffecd2, #fcb69f); }
        .sunny .shape-4 { background: linear-gradient(45deg, #a8edea, #fed6e3); }

        .rainy .shape-1 { background: linear-gradient(45deg, #74b9ff, #0984e3); }
        .rainy .shape-2 { background: linear-gradient(45deg, #6c5ce7, #a29bfe); }
        .rainy .shape-3 { background: linear-gradient(45deg, #fd79a8, #fdcb6e); }
        .rainy .shape-4 { background: linear-gradient(45deg, #00cec9, #55efc4); }

        .cloudy .shape-1 { background: linear-gradient(45deg, #ddd6fe, #c4b5fd); }
        .cloudy .shape-2 { background: linear-gradient(45deg, #e2e8f0, #cbd5e0); }
        .cloudy .shape-3 { background: linear-gradient(45deg, #f1f5f9, #e2e8f0); }
        .cloudy .shape-4 { background: linear-gradient(45deg, #f8fafc, #f1f5f9); }

        /* ÈÄºÁúüÊó∂ÈíüÊ†∑Âºè */
        .beijing-clock {
            text-align: center;
            position: relative;
            z-index: 2;
            margin-top: 60px;
        }

        .clock-face {
            width: 140px;
            height: 140px;
            border: 4px solid #2c3e50;
            border-radius: 50%;
            margin: 0 auto 15px;
            position: relative;
            background: radial-gradient(circle at center, #ffffff 0%, #f8f9fa 70%, #e9ecef 100%);
            box-shadow: 
                0 8px 16px rgba(0,0,0,0.2),
                inset 0 2px 4px rgba(0,0,0,0.1),
                inset 0 -2px 4px rgba(255,255,255,0.5);
        }

        /* Êó∂ÈíüÂàªÂ∫¶Á∫ø */
        .clock-marks {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .hour-mark, .minute-mark {
            position: absolute;
            background: #2c3e50;
            transform-origin: center bottom;
        }

        .hour-mark {
            width: 3px;
            height: 12px;
            top: 4px;
            left: 68.5px;
            border-radius: 1px;
        }

        .minute-mark {
            width: 1px;
            height: 6px;
            top: 7px;
            left: 69.5px;
            opacity: 0.6;
        }

        .clock-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, #2c3e50 30%, #34495e 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .clock-hand {
            position: absolute;
            transform-origin: bottom center;
            transition: transform 0.1s ease-out;
        }

        .hour-hand {
            width: 5px;
            height: 38px;
            top: 32px;
            left: 67.5px;
            background: linear-gradient(to top, #2c3e50 0%, #34495e 100%);
            border-radius: 3px 3px 0 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 3;
        }

        .minute-hand {
            width: 3px;
            height: 50px;
            top: 20px;
            left: 68.5px;
            background: linear-gradient(to top, #2c3e50 0%, #34495e 100%);
            border-radius: 2px 2px 0 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 2;
        }

        .second-hand {
            width: 1px;
            height: 55px;
            top: 15px;
            left: 69.5px;
            background: linear-gradient(to top, #e74c3c 0%, #c0392b 100%);
            border-radius: 1px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
            z-index: 4;
        }

        /* ÁßíÈíàÂ∞ñÁ´Ø */
        .second-hand::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: -2px;
            width: 5px;
            height: 5px;
            background: #e74c3c;
            border-radius: 50%;
        }

        .clock-numbers {
            position: absolute;
            width: 100%;
            height: 100%;
            font-size: 14px;
            font-weight: bold;
            color: #2c3e50;
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
        }

        .clock-number {
            position: absolute;
            transform: translate(-50%, -50%);
            font-family: 'Arial', sans-serif;
        }

        /* Êâ©Â±ïÂ§©Ê∞î‰ø°ÊÅØÊ†∑Âºè */
        .extended-weather {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .weather-main {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
        }

        #weatherIcon {
            font-size: 2rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .weather-text {
            text-align: center;
        }

        #weatherTemp {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            line-height: 1;
        }

        #weatherCondition {
            font-size: 0.9rem;
            color: #666;
            margin-top: 2px;
        }

        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .weather-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 10px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .weather-item:hover {
            background: rgba(255, 255, 255, 0.7);
            transform: translateY(-1px);
        }

        .weather-label {
            color: #666;
            font-weight: 500;
        }

        .weather-item span:last-child {
            color: #333;
            font-weight: 600;
        }

        /* Êó•ÂéÜÊ†∑Âºè */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            position: relative;
            min-height: 35px;
        }

        .calendar-day:hover {
            background-color: #f0f2f5;
        }

        .calendar-day.today {
            background-color: #667eea;
            color: white;
            font-weight: bold;
        }

        .calendar-day.other-month {
            color: #ccc;
        }

        .calendar-day.has-events {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
        }

        .calendar-day.has-events.today {
            background-color: #667eea;
            border: 1px solid #667eea;
        }

        .calendar-day.important {
            background-color: #f8d7da;
            border: 1px solid #dc3545;
            font-weight: bold;
        }

        .calendar-day.important.today {
            background-color: #667eea;
            border: 1px solid #667eea;
        }

        .weekday-header {
            text-align: center;
            font-weight: bold;
            color: #667eea;
            padding: 8px 0;
            font-size: 0.9rem;
        }

        .event-indicator {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: #ff4757;
            border-radius: 50%;
        }

        .event-indicator.today {
            background: white;
        }

        /* ‰∫ã‰ª∂ËØ¶ÊÉÖÂºπÁ™ó */
        .event-popup {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 200px;
            display: none;
        }

        .event-popup.show {
            display: block;
        }

        .event-item {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }

        .event-item:last-child {
            border-bottom: none;
        }

        .event-time {
            color: #667eea;
            font-weight: bold;
        }

        .event-title {
            color: #333;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .dashboard-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .personal-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .widget-card {
                padding: 15px;
            }
            
            .clock-face {
                width: 120px;
                height: 120px;
            }
            
            .hour-hand {
                height: 32px;
                top: 28px;
                left: 57.5px;
            }
            
            .minute-hand {
                height: 42px;
                top: 18px;
                left: 58.5px;
            }
            
            .second-hand {
                height: 47px;
                top: 13px;
                left: 59.5px;
            }
            
            .clock-center {
                width: 10px;
                height: 10px;
            }
            
            .clock-numbers .clock-number {
                font-size: 12px;
            }
            
            .hour-mark {
                width: 2px;
                height: 10px;
                top: 3px;
                left: 59px;
            }
            
            .minute-mark {
                width: 1px;
                height: 5px;
                top: 6px;
                left: 59.5px;
            }
            
            .app-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .app-sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .app-main {
                margin-left: 0;
            }
            
            .app-header {
                padding: 0 15px;
            }
            
            .app-logo {
                font-size: 1.1rem;
            }
            
            .section-header h1 {
                font-size: 1.5rem;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-text {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
    <header class="app-header">
        <div class="app-logo">
            <span style="font-size: 1.8rem;">üé§</span>
            <span>ÈòÖËØªÂèçÈ¶àÁ≥ªÁªü</span>
        </div>
        <div class="user-info" id="userInfo">
            <div class="user-email" id="userEmail"></div>
            <button class="logout-btn" onclick="logout()">ÈÄÄÂá∫ÁôªÂΩï</button>
        </div>
    </header>
    
    <!-- ‰æßËæπÂØºËà™Ê†è -->
    <aside class="app-sidebar">
        <nav class="sidebar-nav">
            <div class="nav-item active" data-section="overview" onclick="navigateTo('overview')">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">È¶ñÈ°µÊ¶ÇËßà</span>
            </div>
            <div class="nav-item" data-section="upload" onclick="navigateTo('upload')">
                <span class="nav-icon">üìù</span>
                <span class="nav-text">‰∏ä‰º†Á¨îËÆ∞</span>
            </div>
            <div class="nav-item" data-section="actions" onclick="navigateTo('actions')">
                <span class="nav-icon">üéØ</span>
                <span class="nav-text">ÊàëÁöÑË°åÂä®È°π</span>
            </div>
            <div class="nav-item" data-section="stats" onclick="navigateTo('stats')">
                <span class="nav-icon">üìà</span>
                <span class="nav-text">ÂÆûË∑µÁªüËÆ°</span>
            </div>
            <div class="nav-divider"></div>
            <div class="nav-item" onclick="goToSelfTalk()">
                <span class="nav-icon">üé§</span>
                <span class="nav-text">Self-Talk</span>
            </div>
            <div class="nav-item" onclick="goToDashboard()">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Êï∞ÊçÆÁúãÊùø</span>
            </div>
            <div class="nav-item" onclick="goToUserCenter()">
                <span class="nav-icon">üë§</span>
                <span class="nav-text">‰∏™‰∫∫‰∏≠ÂøÉ</span>
            </div>
        </nav>
    </aside>
    
    <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
    <main class="app-main">
        <!-- ÂÖ®Â±ÄÊ∂àÊÅØÊèêÁ§∫ -->
        <div id="message"></div>
        
        <!-- È¶ñÈ°µÊ¶ÇËßàÂå∫ -->
        <section id="overview" class="content-section active">
            <div class="section-header">
                <h1>Ê¨¢Ëøé‰ΩøÁî®ÈòÖËØªÂèçÈ¶àÁ≥ªÁªü</h1>
                <p>ËÆ∞ÂΩïÂÜÖÂøÉÂØπËØùÔºåËÆ©ÊÄùËÄÉÊõ¥ÊúâÂäõÈáè</p>
            </div>
            
            <!-- Êñ∞Â¢ûÔºöÈ¶ñÈ°µ‰ª™Ë°®ÊùøÂå∫Âüü -->
            <div class="homepage-dashboard">
                <!-- Á¨¨‰∏ÄË°åÔºöÊó∂ÈíüÂíåÊó•ÂéÜ -->
                <div class="dashboard-row">
                    <!-- Âåó‰∫¨Êó∂Èó¥Êó∂Èíü -->
                    <div class="widget-card clock-widget">
                        <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.2rem;">üïê Âåó‰∫¨Êó∂Èó¥</h3>
                        
                        <!-- Âä®ÊÄÅËÉåÊôØÂå∫Âüü -->
                        <div class="dynamic-background" id="dynamicBackground">
                            <div class="abstract-shapes">
                                <div class="shape shape-1"></div>
                                <div class="shape shape-2"></div>
                                <div class="shape shape-3"></div>
                                <div class="shape shape-4"></div>
                            </div>
                        </div>
                        
                        <div class="beijing-clock">
                            <div class="clock-face">
                                <!-- Êó∂ÈíüÂàªÂ∫¶Á∫ø -->
                                <div class="clock-marks" id="clockMarks"></div>
                                
                                <!-- Êó∂ÈíüÊï∞Â≠ó -->
                                <div class="clock-numbers">
                                    <div class="clock-number" style="top: 12px; left: 70px;">12</div>
                                    <div class="clock-number" style="top: 22px; left: 95px;">1</div>
                                    <div class="clock-number" style="top: 35px; left: 115px;">2</div>
                                    <div class="clock-number" style="top: 70px; left: 120px;">3</div>
                                    <div class="clock-number" style="top: 105px; left: 115px;">4</div>
                                    <div class="clock-number" style="top: 118px; left: 95px;">5</div>
                                    <div class="clock-number" style="top: 128px; left: 70px;">6</div>
                                    <div class="clock-number" style="top: 118px; left: 45px;">7</div>
                                    <div class="clock-number" style="top: 105px; left: 25px;">8</div>
                                    <div class="clock-number" style="top: 70px; left: 20px;">9</div>
                                    <div class="clock-number" style="top: 35px; left: 25px;">10</div>
                                    <div class="clock-number" style="top: 22px; left: 45px;">11</div>
                                </div>
                                
                                <!-- Êó∂ÈíüÊåáÈíà -->
                                <div class="clock-hand hour-hand" id="hourHand"></div>
                                <div class="clock-hand minute-hand" id="minuteHand"></div>
                                <div class="clock-hand second-hand" id="secondHand"></div>
                                
                                <!-- Êó∂Èíü‰∏≠ÂøÉÁÇπ -->
                                <div class="clock-center"></div>
                            </div>
                            <div class="date-display" id="beijingDate" style="color: #666; font-size: 1rem;"></div>
                        </div>
                        
                        <!-- Êâ©Â±ïÂ§©Ê∞î‰ø°ÊÅØ -->
                        <div class="extended-weather" id="extendedWeather">
                            <div class="weather-main">
                                <div id="weatherIcon">‚òÄÔ∏è</div>
                                <div class="weather-text">
                                    <div id="weatherTemp">22‚ÑÉ</div>
                                    <div id="weatherCondition">Êô¥Êúó</div>
                                </div>
                            </div>
                            <div class="weather-details">
                                <div class="weather-item">
                                    <span class="weather-label">Êó•Âá∫</span>
                                    <span id="sunrise">6:30</span>
                                </div>
                                <div class="weather-item">
                                    <span class="weather-label">Êó•ËêΩ</span>
                                    <span id="sunset">18:20</span>
                                </div>
                                <div class="weather-item">
                                    <span class="weather-label">ÊπøÂ∫¶</span>
                                    <span id="humidity">65%</span>
                                </div>
                                <div class="weather-item">
                                    <span class="weather-label">È£éÈÄü</span>
                                    <span id="windSpeed">2m/s</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Êó•ÂéÜÁªÑ‰ª∂ -->
                    <div class="widget-card">
                        <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.2rem;">üìÖ Êó•ÂéÜ</h3>
                        <div class="calendar-widget">
                            <div class="calendar-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <button class="nav-btn" onclick="previousMonth()" style="background: #667eea; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">‚Äπ</button>
                                <span class="month-year" id="monthYear" style="font-weight: bold; color: #333;"></span>
                                <button class="nav-btn" onclick="nextMonth()" style="background: #667eea; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">‚Ä∫</button>
                            </div>
                            <div class="calendar-grid" id="calendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px;"></div>
                        </div>
                        <!-- ‰ªäÊó•ÂæÖÂäû -->
                        <div class="today-todos" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
                            <h4 style="color: #667eea; margin-bottom: 10px; font-size: 1rem;">üìã ‰ªäÊó•ÂæÖÂäû</h4>
                            <div id="todayTodosList" class="todos-list">
                                <div class="todo-item">
                                    <span class="todo-text">üìñ ÈòÖËØª„ÄäÊ∑±Â∫¶Â∑•‰Ωú„Äã30ÂàÜÈíü</span>
                                    <button class="todo-check">‚úì</button>
                                </div>
                                <div class="todo-item">
                                    <span class="todo-text">üí≠ ËÆ∞ÂΩï‰ªäÊó•ÂèçÊÄù</span>
                                    <button class="todo-check">‚úì</button>
                                </div>
                                <div class="todo-item">
                                    <span class="todo-text">üéØ ÂÆåÊàêË°åÂä®È°πÂõûÈ°æ</span>
                                    <button class="todo-check">‚úì</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Á¨¨‰∫åË°åÔºö‰ªäÊó•Ê¶ÇËßàÂíåÂø´ÈÄüÊìç‰Ωú -->
                <div class="dashboard-row">
                    <!-- ‰ªäÊó•Ê¶ÇËßà -->
                    <div class="widget-card">
                        <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.2rem;">üìä ‰ªäÊó•Ê¶ÇËßà</h3>
                        <div class="overview-stats">
                            <div class="stat-item">
                                <div class="stat-icon">üìö</div>
                                <div class="stat-content">
                                    <div class="stat-value" id="todayReadingTime">2Â∞èÊó∂30ÂàÜ</div>
                                    <div class="stat-label">‰ªäÊó•ÈòÖËØªÊó∂Èïø</div>
                                    <div class="stat-progress">
                                        <div class="progress-bar" style="width: 75%;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">‚úÖ</div>
                                <div class="stat-content">
                                    <div class="stat-value" id="completedActions">3/5</div>
                                    <div class="stat-label">ÂÆåÊàêË°åÂä®È°π</div>
                                    <div class="stat-progress">
                                        <div class="progress-bar" style="width: 60%;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">üéØ</div>
                                <div class="stat-content">
                                    <div class="stat-value" id="practiceCount">7Ê¨°</div>
                                    <div class="stat-label">‰ªäÊó•ÂÆûË∑µ</div>
                                    <div class="stat-progress">
                                        <div class="progress-bar" style="width: 85%;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Âø´ÈÄüÊìç‰Ωú -->
                    <div class="widget-card">
                        <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.2rem;">‚ö° Âø´ÈÄüÊìç‰Ωú</h3>
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="startReading()">
                                <div class="action-icon">üìñ</div>
                                <div class="action-text">ÂºÄÂßãÈòÖËØª</div>
                            </button>
                            <button class="quick-action-btn" onclick="recordSelfTalk()">
                                <div class="action-icon">üí≠</div>
                                <div class="action-text">ËÆ∞ÂΩïÂØπËØù</div>
                            </button>
                            <button class="quick-action-btn" onclick="addAction()">
                                <div class="action-icon">üéØ</div>
                                <div class="action-text">Ê∑ªÂä†Ë°åÂä®È°π</div>
                            </button>
                            <button class="quick-action-btn" onclick="viewDashboard()">
                                <div class="action-icon">üìä</div>
                                <div class="action-text">Êü•ÁúãÊï∞ÊçÆ</div>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Á¨¨‰∏âË°åÔºö‰∏™‰∫∫ÁªüËÆ° -->
                <div class="dashboard-row">
                    <!-- ‰∏™‰∫∫ÁªüËÆ° -->
                    <div class="widget-card full-width">
                        <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.2rem;">üìà ‰∏™‰∫∫ÁªüËÆ°</h3>
                        <div class="personal-stats">
                            <div class="stat-card">
                                <div class="stat-icon-large">üéØ</div>
                                <div class="stat-info">
                                    <div class="stat-value-large" id="weeklyGoal">85%</div>
                                    <div class="stat-label-large">Êú¨Âë®ÈòÖËØªÁõÆÊ†á</div>
                                    <div class="stat-trend">‚ÜóÔ∏è +12%</div>
                                </div>
                                <div class="stat-chart">
                                    <div class="mini-chart" id="weeklyChart"></div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon-large">üî•</div>
                                <div class="stat-info">
                                    <div class="stat-value-large" id="streakDays">7Â§©</div>
                                    <div class="stat-label-large">ËøûÁª≠ÈòÖËØª</div>
                                    <div class="stat-trend">‚ÜóÔ∏è +2Â§©</div>
                                </div>
                                <div class="stat-chart">
                                    <div class="mini-chart" id="streakChart"></div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon-large">üìä</div>
                                <div class="stat-info">
                                    <div class="stat-value-large" id="successRate">78%</div>
                                    <div class="stat-label-large">ÂÆûË∑µÊàêÂäüÁéá</div>
                                    <div class="stat-trend">‚ÜóÔ∏è +5%</div>
                                </div>
                                <div class="stat-chart">
                                    <div class="mini-chart" id="successChart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Âø´Êç∑ÂÖ•Âè£Âç°Áâá -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <!-- Self-talk ÂÖ•Âè£ -->
                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; cursor: pointer;" onclick="goToSelfTalk()">
                    <h2 style="color: white;">üé§ Self-talk ÂÜÖÂøÉÂØπËØù</h2>
                    <p style="margin-bottom: 20px; opacity: 0.9;">ËÆ∞ÂΩï‰Ω†ÁöÑÂÜÖÂøÉÂØπËØùÔºåËÆ©ÊÄùËÄÉÊõ¥ÊúâÂäõÈáè</p>
                    <button class="btn" style="background: white; color: #667eea; width: auto; padding: 12px 30px; font-size: 1.1rem;">
                        ÂºÄÂßã Self-talk ‚Üí
                    </button>
                </div>
                
                <!-- Êï∞ÊçÆÂèØËßÜÂåñÂÖ•Âè£ -->
                <div class="card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; cursor: pointer;" onclick="goToDashboard()">
                    <h2 style="color: white;">üìä Êï∞ÊçÆÂèØËßÜÂåñ</h2>
                    <p style="margin-bottom: 20px; opacity: 0.9;">Ê∑±ÂÖ•ÂàÜÊûê‰Ω†ÁöÑË°å‰∏∫Êï∞ÊçÆÔºåÂèëÁé∞ÊàêÈïøËßÑÂæã</p>
                    <button class="btn" style="background: white; color: #f5576c; width: auto; padding: 12px 30px; font-size: 1.1rem;">
                        Êü•Áúã‰ª™Ë°®Áõò ‚Üí
                    </button>
                </div>
            </div>
        </section>
        
        <!-- ‰∏ä‰º†Á¨îËÆ∞Âå∫ -->
        <section id="upload" class="content-section">
            <div class="section-header">
                <h1>üìù ‰∏ä‰º†ËØª‰π¶Á¨îËÆ∞</h1>
                <p>‰∏ä‰º†‰Ω†ÁöÑËØª‰π¶Á¨îËÆ∞ÔºåÁ≥ªÁªüÂ∞ÜËá™Âä®ÊäΩÂèñÂèØÊâßË°åÁöÑË°åÂä®È°π</p>
            </div>
            
            <div class="card">
                <h2>üìù ‰∏ä‰º†ËØª‰π¶Á¨îËÆ∞</h2>
                <form id="uploadForm">
                    <div class="form-group">
                        <label for="bookTitle">‰π¶Á±çÂêçÁß∞</label>
                        <input type="text" id="bookTitle" placeholder="ËØ∑ËæìÂÖ•‰π¶Á±çÂêçÁß∞">
                    </div>
                    <div class="form-group">
                        <label for="notesContent">Á¨îËÆ∞ÂÜÖÂÆπ</label>
                        <textarea id="notesContent" placeholder="ËØ∑ËæìÂÖ•‰Ω†ÁöÑËØª‰π¶Á¨îËÆ∞ÂÜÖÂÆπ..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn" id="uploadBtn">üöÄ ÊäΩÂèñË°åÂä®È°π</button>
                </form>
            </div>
        </section>
        
        <!-- Ë°åÂä®È°πÁÆ°ÁêÜÂå∫ -->
        <section id="actions" class="content-section">
            <div class="section-header">
                <h1>üéØ ÊàëÁöÑË°åÂä®È°π</h1>
                <p>ÁÆ°ÁêÜÂíåËøΩË∏™‰Ω†ÁöÑË°åÂä®È°πÊâßË°åÊÉÖÂÜµ</p>
            </div>
            
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>üéØ ÊàëÁöÑË°åÂä®È°π</h2>
                    <button class="btn-small" id="batchTimeBtn" onclick="showBatchTimeManagementModal()" style="background: #17a2b8; color: white; display: none;">
                        ‚è∞ ÊâπÈáèËÆæÁΩÆÊó∂Èó¥
                    </button>
                </div>
                
                <!-- Ë°åÂä®Á±ªÂûãÁ≠õÈÄâ -->
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="action-type-filter active" data-type="all" onclick="filterActionsByType('all')">
                            üìã ÂÖ®ÈÉ®
                        </button>
                        <button class="action-type-filter" data-type="trigger" onclick="filterActionsByType('trigger')">
                            üéØ ÊÉÖÂ¢ÉËß¶ÂèëÂûã
                        </button>
                        <button class="action-type-filter" data-type="habit" onclick="filterActionsByType('habit')">
                            üîÑ ‰π†ÊÉØÂÖªÊàêÂûã
                        </button>
                    </div>
                </div>
                
                <div id="actionsList" class="actions-list">
                    <div class="loading">ÁÇπÂáª"ÊäΩÂèñË°åÂä®È°π"ÂºÄÂßã...</div>
                </div>
            </div>
        </section>
        
        <!-- ‰∏™‰∫∫‰∏≠ÂøÉÂå∫ -->
        <section id="user-center" class="content-section hidden">
            <div class="section-header">
                <button class="back-btn" onclick="navigateTo('overview')" style="position: absolute; left: 20px; top: 20px; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #667eea;">&larr; ËøîÂõû</button>
                <h1>üë§ ‰∏™‰∫∫‰∏≠ÂøÉ</h1>
            </div>
            
            <div class="content-wrapper" style="max-width: 800px; margin: 0 auto; padding: 20px;">
                <!-- Áî®Êà∑‰ø°ÊÅØÂå∫Âüü -->
                <div class="user-info-section card" style="margin-bottom: 30px; padding: 25px; background: #f8f9fa; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4 style="color: #667eea; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; font-size: 1.2rem;">
                        <span>üìù</span> ‰∏™‰∫∫‰ø°ÊÅØ
                    </h4>
                    <div class="user-detail" style="margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between;">
                        <label style="font-weight: 600; color: #555; min-width: 80px;">ÊòµÁß∞:</label>
                        <span id="userDisplayName" style="flex: 1; color: #333;">Âä†ËΩΩ‰∏≠...</span>
                        <button onclick="showEditNameModal()" style="padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">ÁºñËæë</button>
                    </div>
                    <div class="user-detail" style="margin-bottom: 15px; display: flex; align-items: center;">
                        <label style="font-weight: 600; color: #555; min-width: 80px;">ÈÇÆÁÆ±:</label>
                        <span id="userDisplayEmail" style="flex: 1; color: #333;">Âä†ËΩΩ‰∏≠...</span>
                    </div>
                    <div class="user-detail" style="display: flex; align-items: center;">
                        <label style="font-weight: 600; color: #555; min-width: 80px;">Áî®Êà∑Á≠âÁ∫ß:</label>
                        <span id="userDisplayPlan" style="flex: 1; color: #333;">Âä†ËΩΩ‰∏≠...</span>
                    </div>
                </div>

                <!-- ÊèêÈÜíËÆæÁΩÆÂå∫Âüü -->
                <div class="reminder-settings-section card" style="padding: 25px; background: #f8f9fa; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4 style="color: #667eea; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; font-size: 1.2rem;">
                        <span>üîî</span> ÊèêÈÜíËÆæÁΩÆ
                    </h4>
                    
                    <!-- ÊÄªÂºÄÂÖ≥ -->
                    <div class="setting-item" style="margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; gap: 8px; font-size: 1rem;">
                            <input type="checkbox" id="reminderMasterSwitch" style="transform: scale(1.2);">
                            <span>ÂêØÁî®ÊèêÈÜíÂäüËÉΩ</span>
                        </label>
                    </div>

                    <!-- ÂÆöÊó∂ÊèêÈÜíËÆæÁΩÆ -->
                    <div class="reminder-subsection" style="margin-left: 20px; margin-top: 15px; margin-bottom: 15px;">
                        <h5 style="color: #555; margin-bottom: 10px; font-size: 1rem;">‚è∞ ÂÆöÊó∂ÊèêÈÜí</h5>
                        <div class="setting-item" style="margin-bottom: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="reminderDailySwitch" style="transform: scale(1.2);">
                                <span>ÂêØÁî®ÂÆöÊó∂ÊèêÈÜí</span>
                            </label>
                        </div>
                        <div class="setting-item" style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                            <label style="font-weight: 600; color: #555;">ÊèêÈÜíÊó∂Èó¥:</label>
                            <input type="time" id="dailyReminderTime" value="20:00" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem;">
                        </div>
                        <div class="setting-item">
                            <label style="font-weight: 600; color: #555; display: block; margin-bottom: 5px;">ÊèêÈÜíÊó•Êúü:</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <label style="display: flex; align-items: center; gap: 4px; font-size: 0.9rem;">
                                    <input type="checkbox" id="reminderDay0" checked style="transform: scale(1.1);">
                                    Âë®Êó•
                                </label>
                                <label style="display: flex; align-items: center; gap: 4px; font-size: 0.9rem;">
                                    <input type="checkbox" id="reminderDay1" checked style="transform: scale(1.1);">
                                    Âë®‰∏Ä
                                </label>
                                <label style="display: flex; align-items: center; gap: 4px; font-size: 0.9rem;">
                                    <input type="checkbox" id="reminderDay2" checked style="transform: scale(1.1);">
                                    Âë®‰∫å
                                </label>
                                <label style="display: flex; align-items: center; gap: 4px; font-size: 0.9rem;">
                                    <input type="checkbox" id="reminderDay3" checked style="transform: scale(1.1);">
                                    Âë®‰∏â
                                </label>
                                <label style="display: flex; align-items: center; gap: 4px; font-size: 0.9rem;">
                                    <input type="checkbox" id="reminderDay4" checked style="transform: scale(1.1);">
                                    Âë®Âõõ
                                </label>
                                <label style="display: flex; align-items: center; gap: 4px; font-size: 0.9rem;">
                                    <input type="checkbox" id="reminderDay5" checked style="transform: scale(1.1);">
                                    Âë®‰∫î
                                </label>
                                <label style="display: flex; align-items: center; gap: 4px; font-size: 0.9rem;">
                                    <input type="checkbox" id="reminderDay6" checked style="transform: scale(1.1);">
                                    Âë®ÂÖ≠
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Ë°å‰∏∫Ëß¶ÂèëÊèêÈÜíËÆæÁΩÆ -->
                    <div class="reminder-subsection" style="margin-left: 20px; margin-top: 15px; margin-bottom: 15px;">
                        <h5 style="color: #555; margin-bottom: 10px; font-size: 1rem;">üéØ Ë°å‰∏∫Ëß¶ÂèëÊèêÈÜí</h5>
                        <div class="setting-item" style="margin-bottom: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="reminderActionSwitch" style="transform: scale(1.2);">
                                <span>ÂÆåÊàêË°åÂä®ÂêéÊèêÈÜí</span>
                            </label>
                        </div>
                        <div class="setting-item" style="margin-bottom: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="reminderNewActionSwitch" style="transform: scale(1.2);">
                                <span>Ê∑ªÂä†Êñ∞Ë°åÂä®ÂêéÊèêÈÜí</span>
                            </label>
                        </div>
                    </div>

                    <!-- ÈùûÊ¥ªË∑ÉÊèêÈÜíËÆæÁΩÆ -->
                    <div class="reminder-subsection" style="margin-left: 20px; margin-top: 15px; margin-bottom: 15px;">
                        <h5 style="color: #555; margin-bottom: 10px; font-size: 1rem;">üò¥ ÈùûÊ¥ªË∑ÉÊèêÈÜí</h5>
                        <div class="setting-item" style="display: flex; align-items: center; gap: 10px;">
                            <label style="font-weight: 600; color: #555;">ÈùûÊ¥ªË∑ÉÂ§©Êï∞ÈòàÂÄº:</label>
                            <select id="inactiveDaysThreshold" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem;">
                                <option value="1">1Â§©</option>
                                <option value="2">2Â§©</option>
                                <option value="3" selected>3Â§©</option>
                                <option value="5">5Â§©</option>
                                <option value="7">7Â§©</option>
                                <option value="10">10Â§©</option>
                                <option value="15">15Â§©</option>
                                <option value="30">30Â§©</option>
                            </select>
                        </div>
                    </div>

                    <!-- ÈÄöÁü•ÊñπÂºèËÆæÁΩÆ -->
                    <div class="reminder-subsection" style="margin-left: 20px; margin-top: 15px; margin-bottom: 15px;">
                        <h5 style="color: #555; margin-bottom: 10px; font-size: 1rem;">üì± ÈÄöÁü•ÊñπÂºè</h5>
                        <div class="setting-item" style="margin-bottom: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="reminderBrowserSwitch" style="transform: scale(1.2);">
                                <span>ÊµèËßàÂô®ÈÄöÁü•</span>
                            </label>
                        </div>
                        <div class="setting-item" style="margin-bottom: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="reminderEmailSwitch" style="transform: scale(1.2);">
                                <span>ÈÇÆ‰ª∂ÈÄöÁü•</span>
                            </label>
                        </div>
                    </div>

                    <button onclick="saveReminderSettings()" style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; width: 100%;">‰øùÂ≠òËÆæÁΩÆ</button>
                </div>

                <!-- ÈÄÄÂá∫ÁôªÂΩïÊåâÈíÆ -->
                <button onclick="confirmLogout()" style="margin-top: 30px; padding: 10px 20px; background: #ff4d4f; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; width: 100%;">
                    ÈÄÄÂá∫ÁôªÂΩï
                </button>
            </div>
        </section>
        
        <!-- ÂÆûË∑µÁªüËÆ°Âå∫ -->
        <section id="stats" class="content-section">
            <div class="section-header">
                <h1>üìä ÂÆûË∑µÁªüËÆ°</h1>
                <p>Êü•Áúã‰Ω†ÁöÑÂÆûË∑µÊï∞ÊçÆÂíåÊàêÈïøËΩ®Ëøπ</p>
            </div>
            
            <div class="card dashboard">
            <h2>üìä ÂÆûË∑µÁªüËÆ°</h2>
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-number" id="totalActions">-</div>
                    <div class="stat-label">ÊÄªË°åÂä®È°π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedActions">-</div>
                    <div class="stat-label">Â∑≤ÂÆåÊàê</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completionRate">-</div>
                    <div class="stat-label">ÂÆåÊàêÁéá</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="successRate">-</div>
                    <div class="stat-label">ÊàêÂäüÁéá</div>
                </div>
            </div>
            
            <!-- Êó∂Èó¥Áª¥Â∫¶ÂàÜÊûê -->
            <div style="margin-top: 30px;">
                <h3>‚è∞ Êó∂Èó¥Áª¥Â∫¶ÂàÜÊûê</h3>
                <div class="stats-grid" id="durationStatsGrid">
                    <div class="stat-card">
                        <div class="stat-number" id="shortTermActions">-</div>
                        <div class="stat-label">Áü≠ÊúüË°åÂä®È°π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="longTermActions">-</div>
                        <div class="stat-label">ÈïøÊúüË°åÂä®È°π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="lifetimeActions">-</div>
                        <div class="stat-label">ÁªàË∫´Ë°åÂä®È°π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="currentStreak">-</div>
                        <div class="stat-label">ÂΩìÂâçËøûÁª≠Â§©Êï∞</div>
                    </div>
                </div>
            </div>
            
            <!-- ÂùöÊåÅÂ∫¶ÂàÜÊûê -->
            <div style="margin-top: 30px;" id="streakAnalysis" style="display: none;">
                <h3>üî• ÂùöÊåÅÂ∫¶ÂàÜÊûê</h3>
                <div id="streakDetails"></div>
            </div>
            </div>
        </section>
    </main>
    
    <!-- ÁôªÂΩï/Ê≥®ÂÜåÊ®°ÊÄÅÊ°Ü -->
    <div class="auth-modal" id="authModal">
        <div class="auth-container">
            <button class="close-modal" onclick="closeAuthModal()">&times;</button>
            <div class="auth-header">
                <h2>Ê¨¢Ëøé‰ΩøÁî®ËØª‰π¶Á¨îËÆ∞Á≥ªÁªü</h2>
                <p>ËØ∑ÈÄâÊã©ÁôªÂΩïÊàñÊ≥®ÂÜåÊñ∞Ë¥¶Êà∑</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchTab('login')">ÁôªÂΩï</button>
                <button class="auth-tab" onclick="switchTab('register')">Ê≥®ÂÜå</button>
            </div>
            
            <!-- ÁôªÂΩïË°®Âçï -->
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">ÈÇÆÁÆ±Âú∞ÂùÄ</label>
                    <input type="email" id="loginEmail" required placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÈÇÆÁÆ±">
                </div>
                <div class="form-group">
                    <label for="loginPassword">ÂØÜÁ†Å</label>
                    <input type="password" id="loginPassword" required placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å">
                </div>
                <button type="submit" class="auth-btn">ÁôªÂΩï</button>
            </form>
            
            <!-- Ê≥®ÂÜåË°®Âçï -->
            <form class="auth-form" id="registerForm">
                <div class="form-group">
                    <label for="registerEmail">ÈÇÆÁÆ±Âú∞ÂùÄ</label>
                    <input type="email" id="registerEmail" required placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÈÇÆÁÆ±">
                </div>
                <div class="form-group">
                    <label for="registerPassword">ÂØÜÁ†Å</label>
                    <input type="password" id="registerPassword" required placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å">
                    <div class="password-hint">ÂØÜÁ†ÅËá≥Â∞ë6‰ΩçÔºåÂª∫ËÆÆÂåÖÂê´Â≠óÊØçÂíåÊï∞Â≠ó</div>
                </div>
                <div class="form-group">
                    <label for="registerName">ÂßìÂêçÔºàÂèØÈÄâÔºâ</label>
                    <input type="text" id="registerName" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂßìÂêç">
                </div>
                <button type="submit" class="auth-btn">Ê≥®ÂÜå</button>
            </form>
        </div>
    </div>
    
    <!-- ÊâπÈáèÊó∂Èó¥ÁÆ°ÁêÜËÆæÁΩÆÊ®°ÊÄÅÊ°Ü -->
    <div class="practice-modal hidden" id="batchTimeManagementModal">
        <div class="practice-container">
            <button class="close-modal" onclick="closeBatchTimeManagementModal()">&times;</button>
            <div class="practice-header">
                <h3>‚è∞ ÊâπÈáèËÆæÁΩÆÊó∂Èó¥ÁÆ°ÁêÜ</h3>
                <p style="color: #666; font-size: 14px; margin-top: 5px;">Ê≠§ËÆæÁΩÆÂ∞ÜÂ∫îÁî®Âà∞ÊâÄÊúâÊú™ÂÆåÊàêÁöÑË°åÂä®È°π</p>
            </div>
            
            <form id="batchTimeManagementForm">
                <div class="form-group">
                    <label for="btmDurationType">Á±ªÂûã</label>
                    <select id="btmDurationType" onchange="toggleBTMDurationSettings()">
                        <option value="short_term">Áü≠ÊúüÁõÆÊ†á</option>
                        <option value="long_term">ÈïøÊúüÁõÆÊ†á</option>
                        <option value="lifetime">ÁªàË∫´‰π†ÊÉØ</option>
                    </select>
                </div>
                
                <div class="form-group" id="btmDurationDaysGroup">
                    <label for="btmTargetDurationDays">ÂùöÊåÅÂ§©Êï∞</label>
                    <input type="number" id="btmTargetDurationDays" min="1" max="3650" placeholder="Â§©Êï∞">
                </div>
                
                <div class="form-group">
                    <label for="btmTargetFrequency">È¢ëÁéá</label>
                    <select id="btmTargetFrequency" onchange="toggleBTMCustomFrequency()">
                        <option value="daily">ÊØèÊó•</option>
                        <option value="weekly">ÊØèÂë®</option>
                        <option value="monthly">ÊØèÊúà</option>
                        <option value="custom">Ëá™ÂÆö‰πâ</option>
                    </select>
                </div>
                
                <div class="form-group" id="btmCustomFrequencyGroup" style="display: none;">
                    <label for="btmCustomFrequencyDays">ÊØèÂá†Â§©‰∏ÄÊ¨°</label>
                    <input type="number" id="btmCustomFrequencyDays" min="1" max="365" placeholder="Â§©Êï∞">
                </div>
                
                <div class="form-group">
                    <label for="btmStartDate">ÂºÄÂßãÊó•Êúü</label>
                    <input type="date" id="btmStartDate">
                </div>
                
                <div class="form-group" id="btmEndDateGroup">
                    <label for="btmEndDate">ÁªìÊùüÊó•Êúü</label>
                    <input type="date" id="btmEndDate">
                </div>
                
                <button type="submit" class="btn">üíæ ÊâπÈáèÂ∫îÁî®ËÆæÁΩÆ</button>
            </form>
        </div>
    </div>
    
    <!-- Êó∂Èó¥ÁÆ°ÁêÜËÆæÁΩÆÊ®°ÊÄÅÊ°ÜÔºà‰π†ÊÉØÂûãÔºâ -->
    <div class="practice-modal hidden" id="timeManagementModal">
        <div class="practice-container">
            <button class="close-modal" onclick="closeTimeManagementModal()">&times;</button>
            <div class="practice-header">
                <h3>‚è∞ ËÆæÁΩÆÊó∂Èó¥ÁÆ°ÁêÜ</h3>
            </div>
            
            <form id="timeManagementForm">
                <div class="form-group">
                    <label for="tmDurationType">Á±ªÂûã</label>
                    <select id="tmDurationType" onchange="toggleTMDurationSettings()">
                        <option value="short_term">Áü≠ÊúüÁõÆÊ†á</option>
                        <option value="long_term">ÈïøÊúüÁõÆÊ†á</option>
                        <option value="lifetime">ÁªàË∫´‰π†ÊÉØ</option>
                    </select>
                </div>
                
                <div class="form-group" id="tmDurationDaysGroup">
                    <label for="tmTargetDurationDays">ÂùöÊåÅÂ§©Êï∞</label>
                    <input type="number" id="tmTargetDurationDays" min="1" max="3650" placeholder="Â§©Êï∞">
                </div>
                
                <div class="form-group">
                    <label for="tmTargetFrequency">È¢ëÁéá</label>
                    <select id="tmTargetFrequency" onchange="toggleTMCustomFrequency()">
                        <option value="daily">ÊØèÊó•</option>
                        <option value="weekly">ÊØèÂë®</option>
                        <option value="monthly">ÊØèÊúà</option>
                        <option value="custom">Ëá™ÂÆö‰πâ</option>
                    </select>
                </div>
                
                <div class="form-group" id="tmCustomFrequencyGroup" style="display: none;">
                    <label for="tmCustomFrequencyDays">ÊØèÂá†Â§©‰∏ÄÊ¨°</label>
                    <input type="number" id="tmCustomFrequencyDays" min="1" max="365" placeholder="Â§©Êï∞">
                </div>
                
                <div class="form-group">
                    <label for="tmStartDate">ÂºÄÂßãÊó•Êúü</label>
                    <input type="date" id="tmStartDate">
                </div>
                
                <div class="form-group" id="tmEndDateGroup">
                    <label for="tmEndDate">ÁªìÊùüÊó•Êúü</label>
                    <input type="date" id="tmEndDate">
                </div>
                
                <button type="submit" class="btn">üíæ ‰øùÂ≠òËÆæÁΩÆ</button>
            </form>
        </div>
    </div>
    
    <!-- Ê¨°Êï∞ÂíåÂ§©Êï∞ËÆæÁΩÆÊ®°ÊÄÅÊ°ÜÔºàÊÉÖÂ¢ÉÂûãÔºâ -->
    <div class="practice-modal hidden" id="countAndDaysModal">
        <div class="practice-container">
            <button class="close-modal" onclick="closeCountAndDaysModal()">&times;</button>
            <div class="practice-header">
                <h3>üìä ËÆæÁΩÆÊ¨°Êï∞ÂíåÂ§©Êï∞</h3>
            </div>
            
            <form id="countAndDaysForm">
                <div class="form-group">
                    <label for="cdTargetCount">ÁõÆÊ†áÊ¨°Êï∞</label>
                    <input type="number" id="cdTargetCount" min="1" max="1000" placeholder="ÊúüÊúõÂÆåÊàêÁöÑÊ¨°Êï∞">
                </div>
                
                <div class="form-group">
                    <label for="cdTargetDays">ÂÆåÊàêÂ§©Êï∞</label>
                    <input type="number" id="cdTargetDays" min="1" max="365" placeholder="ÊúüÊúõÂú®Â§öÂ∞ëÂ§©ÂÜÖÂÆåÊàê">
                </div>
                
                <div class="form-group">
                    <label for="cdStartDate">ÂºÄÂßãÊó•Êúü</label>
                    <input type="date" id="cdStartDate">
                </div>
                
                <div class="form-group" id="cdEndDateGroup">
                    <label for="cdEndDate">ÁªìÊùüÊó•Êúü</label>
                    <input type="date" id="cdEndDate">
                </div>
                
                <button type="submit" class="btn">üíæ ‰øùÂ≠òËÆæÁΩÆ</button>
            </form>
        </div>
    </div>
    
    <!-- ÂÆûË∑µËÆ∞ÂΩïÊ®°ÊÄÅÊ°Ü -->
    <div class="practice-modal hidden" id="practiceModal">
        <div class="practice-container">
            <button class="close-modal" onclick="closePracticeModal()">&times;</button>
            <div class="practice-header">
                <h3>üìù ËÆ∞ÂΩïÂÆûË∑µÂèçÈ¶à</h3>
            </div>
            
            <form id="practiceForm">
                <div class="form-group">
                    <label for="practiceDate">ÂÆûË∑µÊó•Êúü</label>
                    <input type="date" id="practiceDate" required>
                </div>
                
                <!-- ÊÉÖÂ¢ÉÂûãË°åÂä®ÊòæÁ§∫Ê¨°Êï∞ËæìÂÖ• -->
                <div class="form-group" id="practiceCountGroup" style="display: none;">
                    <label for="practiceCount">Á¨¨Âá†Ê¨°Ë°åÂä®</label>
                    <input type="number" id="practiceCount" min="1" placeholder="ËøôÊòØÁ¨¨Âá†Ê¨°ÊâßË°åÊ≠§Ë°åÂä®">
                </div>
                
                <div class="form-group">
                    <label for="practiceResult">ÂÆûË∑µÁªìÊûú</label>
                    <select id="practiceResult" required>
                        <option value="">ËØ∑ÈÄâÊã©ÁªìÊûú</option>
                        <option value="success">‚úÖ ÊàêÂäüÂÆåÊàê</option>
                        <option value="partial">‚ö†Ô∏è ÈÉ®ÂàÜÂÆåÊàê</option>
                        <option value="fail">‚ùå Êú™ÂÆåÊàê</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="practiceNotes">ÂÆûË∑µÂèçÈ¶àÔºàÂèØÈÄâÔºâ</label>
                    <textarea id="practiceNotes" placeholder="ËÆ∞ÂΩï‰Ω†ÁöÑÂÆûË∑µËøáÁ®ãÂíåÊÑüÂèó..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Êª°ÊÑèÂ∫¶ËØÑÂàÜ</label>
                    <div class="rating-group">
                        <div class="rating-stars" id="ratingStars">
                            <span class="star" data-rating="1">‚òÖ</span>
                            <span class="star" data-rating="2">‚òÖ</span>
                            <span class="star" data-rating="3">‚òÖ</span>
                            <span class="star" data-rating="4">‚òÖ</span>
                            <span class="star" data-rating="5">‚òÖ</span>
                        </div>
                        <span id="ratingText">Êú™ËØÑÂàÜ</span>
                    </div>
                </div>
                
                <button type="submit" class="auth-btn">‰øùÂ≠òÂÆûË∑µËÆ∞ÂΩï</button>
            </form>
        </div>
    </div>
    
    <!-- ÂÆûË∑µËÆ∞ÂΩïÊü•ÁúãÊ®°ÊÄÅÊ°Ü -->
    <div class="practice-modal hidden" id="practiceLogsModal">
        <div class="practice-container" style="width: 800px; max-height: 80vh; overflow-y: auto;">
            <button class="close-modal" onclick="closePracticeLogsModal()">&times;</button>
            <div class="practice-header">
                <h3>üìã ÂÆûË∑µËÆ∞ÂΩï</h3>
                <p style="color: #666; font-size: 14px; margin-top: 5px;" id="practiceLogsSubtitle">Êü•ÁúãÊâÄÊúâÂÆûË∑µÂèçÈ¶àËÆ∞ÂΩï</p>
            </div>
            
            <div id="practiceLogsList">
                <div class="loading">Ê≠£Âú®Âä†ËΩΩËÆ∞ÂΩï...</div>
            </div>
        </div>
    </div>
    
    <!-- ÁºñËæëË°åÂä®È°πÊ®°ÊÄÅÊ°Ü -->
    <div class="practice-modal hidden" id="editActionModal">
        <div class="practice-container">
            <button class="close-modal" onclick="closeEditActionModal()">&times;</button>
            <div class="practice-header">
                <h3>‚úèÔ∏è ÁºñËæëË°åÂä®È°π</h3>
            </div>
            
            <form id="editActionForm">
                <div class="form-group">
                    <label for="editActionText">Ë°åÂä®ÂÜÖÂÆπ</label>
                    <textarea id="editActionText" required minlength="5" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="editActionType">Ë°åÂä®Á±ªÂûã</label>
                    <select id="editActionType">
                        <option value="trigger">üéØ ÊÉÖÂ¢ÉËß¶ÂèëÂûã</option>
                        <option value="habit">üîÑ ‰π†ÊÉØÂÖªÊàêÂûã</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="editActionTags">Ê†áÁ≠æÔºàÈÄóÂè∑ÂàÜÈöîÔºâ</label>
                    <input type="text" id="editActionTags" placeholder="‰æãÂ¶Ç: ÈòÖËØª, ÊàêÈïø, ÂÅ•Â∫∑">
                </div>
                
                <button type="submit" class="auth-btn">üíæ ‰øùÂ≠ò‰øÆÊîπ</button>
            </form>
        </div>
    </div>
    
    <!-- ‰∏™‰∫∫‰∏≠ÂøÉÂºπÁ™óÂ∑≤ÁßªÈô§ÔºåÁé∞Âú®‰ΩøÁî®section -->
    
    <!-- ÁºñËæëÊòµÁß∞Ê®°ÊÄÅÊ°Ü -->
    <div class="practice-modal hidden" id="editNameModal">
        <div class="practice-container" style="width: 400px;">
            <button class="close-modal" onclick="closeEditNameModal()">&times;</button>
            <div class="practice-header">
                <h3>‚úèÔ∏è ‰øÆÊîπÊòµÁß∞</h3>
            </div>
            
            <form id="editNameForm">
                <div class="form-group">
                    <label for="currentName">ÂΩìÂâçÊòµÁß∞:</label>
                    <input type="text" id="currentName" readonly style="background: #f5f5f5;">
                </div>
                
                <div class="form-group">
                    <label for="newName">Êñ∞ÊòµÁß∞:</label>
                    <input type="text" id="newName" required maxlength="6" placeholder="ËØ∑ËæìÂÖ•Êñ∞ÊòµÁß∞ÔºàÊúÄÂ§ö6‰∏™Â≠óÁ¨¶Ôºâ">
                    <small style="color: #666; font-size: 0.8rem;">ÊòµÁß∞Âè™ËÉΩÂåÖÂê´‰∏≠Êñá„ÄÅËã±Êñá„ÄÅÊï∞Â≠óÔºåÊúÄÂ§ö6‰∏™Â≠óÁ¨¶</small>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" onclick="closeEditNameModal()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer;">ÂèñÊ∂à</button>
                    <button type="submit" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">‰øùÂ≠ò</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- ÈÄÄÂá∫Á°ÆËÆ§ÂØπËØùÊ°Ü -->
    <div class="practice-modal hidden" id="logoutConfirmModal">
        <div class="practice-container" style="width: 400px;">
            <div class="practice-header">
                <h3>‚ö†Ô∏è Á°ÆËÆ§ÈÄÄÂá∫</h3>
            </div>
            
            <div style="padding: 20px; text-align: center;">
                <p style="margin-bottom: 20px; font-size: 1.1rem;">ÊÇ®Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü</p>
                <p style="color: #666; margin-bottom: 30px;">ÈÄÄÂá∫ÂêéÈúÄË¶ÅÈáçÊñ∞ÁôªÂΩïÊâçËÉΩ‰ΩøÁî®Â∫îÁî®ÂäüËÉΩ„ÄÇ</p>
                
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button onclick="closeLogoutConfirmModal()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer;">ÂèñÊ∂à</button>
                    <button onclick="performLogout()" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer;">Á°ÆÂÆöÈÄÄÂá∫</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Âü∫Á°ÄÈÖçÁΩÆ
        const API_BASE = 'http://localhost:8000';
        let authToken = localStorage.getItem('authToken');
        let allActions = []; // Â≠òÂÇ®ÊâÄÊúâË°åÂä®È°π
        let currentFilterType = 'all'; // ÂΩìÂâçÁ≠õÈÄâÁ±ªÂûã
        
        // ============= ÂØºËà™ÂàáÊç¢ÂäüËÉΩ =============
        function navigateTo(sectionId) {
            // ÈöêËóèÊâÄÊúâÂÜÖÂÆπÂå∫
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // ÊòæÁ§∫ÁõÆÊ†áÂÜÖÂÆπÂå∫
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                
                // Â¶ÇÊûúÊòØ‰∏™‰∫∫‰∏≠ÂøÉÔºåÂä†ËΩΩÊï∞ÊçÆ
                if (sectionId === 'user-center') {
                    loadUserInfo();
                    loadReminderSettings();
                }
            }
            
            // Êõ¥Êñ∞ÂØºËà™È´ò‰∫Æ
            document.querySelectorAll('.nav-item[data-section]').forEach(item => {
                item.classList.remove('active');
            });
            const activeNav = document.querySelector(`.nav-item[data-section="${sectionId}"]`);
            if (activeNav) {
                activeNav.classList.add('active');
            }
            
            // Êõ¥Êñ∞URLÔºà‰ΩøÁî®hashÔºåÊó†ÈúÄÂà∑Êñ∞È°µÈù¢Ôºâ
            window.location.hash = sectionId;
            
            // ÁßªÂä®Á´ØÔºöÂÖ≥Èó≠‰æßËæπÊ†è
            if (window.innerWidth <= 768) {
                document.querySelector('.app-sidebar').classList.remove('mobile-open');
            }
        }
        
        // ÊîØÊåÅÊµèËßàÂô®ÂâçËøõ/ÂêéÈÄÄ
        window.addEventListener('hashchange', () => {
            const hash = location.hash.slice(1);
            if (hash && document.getElementById(hash)) {
                navigateTo(hash);
            }
        });
        
        // È°µÈù¢Âä†ËΩΩÊó∂Ê†πÊçÆhashÊòæÁ§∫ÂØπÂ∫îÂå∫Âüü
        window.addEventListener('DOMContentLoaded', () => {
            const hash = location.hash.slice(1);
            if (hash && document.getElementById(hash)) {
                navigateTo(hash);
            }
            
            // ÂàùÂßãÂåñÊó∂ÈíüÂíåÊó•ÂéÜ
            initializeClock();
            initializeCalendar();
            
            // ÂàùÂßãÂåñÊñ∞Â¢ûÁªÑ‰ª∂
            initializeWeather();
            initializeTodayStats();
            initializePersonalStats();
            
            // Ê∑ªÂä†Â§©Ê∞îÂàáÊç¢ÊºîÁ§∫ÔºàÂèØÈÄâÂäüËÉΩÔºâ
            addWeatherDemoFeature();
        });
        // ============= ÂØºËà™ÂàáÊç¢ÂäüËÉΩÁªìÊùü =============
        
        // ============= Êó∂ÈíüÂíåÊó•ÂéÜÂäüËÉΩÂºÄÂßã =============
        
        // ÈÄºÁúüÊó∂ÈíüÂäüËÉΩ
        function initializeClock() {
            createClockMarks();
            updateClock();
            setInterval(updateClock, 100);
        }

        function createClockMarks() {
            const clockMarks = document.getElementById('clockMarks');
            if (!clockMarks) return;

            // ÂàõÂª∫Â∞èÊó∂ÂàªÂ∫¶Á∫øÔºà12‰∏™Ôºâ
            for (let i = 0; i < 12; i++) {
                const hourMark = document.createElement('div');
                hourMark.className = 'hour-mark';
                hourMark.style.transform = `rotate(${i * 30}deg)`;
                clockMarks.appendChild(hourMark);
            }

            // ÂàõÂª∫ÂàÜÈíüÂàªÂ∫¶Á∫øÔºà60‰∏™Ôºâ
            for (let i = 0; i < 60; i++) {
                if (i % 5 !== 0) { // Ë∑≥ËøáÂ∞èÊó∂ÂàªÂ∫¶Á∫ø‰ΩçÁΩÆ
                    const minuteMark = document.createElement('div');
                    minuteMark.className = 'minute-mark';
                    minuteMark.style.transform = `rotate(${i * 6}deg)`;
                    clockMarks.appendChild(minuteMark);
                }
            }
        }

        function updateClock() {
            const now = new Date();
            const beijingTime = new Date(now.getTime() + (8 * 60 * 60 * 1000)); // UTC+8
            
            const hours = beijingTime.getHours();
            const minutes = beijingTime.getMinutes();
            const seconds = beijingTime.getSeconds();
            const milliseconds = beijingTime.getMilliseconds();
            
            // ËÆ°ÁÆóÊåáÈíàËßíÂ∫¶ÔºàÊõ¥Á≤æÁ°ÆÁöÑËÆ°ÁÆóÔºâ
            const secondAngle = seconds * 6 + milliseconds * 0.006; // ÊØèÁßí6Â∫¶ + ÊØ´ÁßíÂΩ±Âìç
            const minuteAngle = minutes * 6 + seconds * 0.1 + milliseconds * 0.0001; // ÊØèÂàÜÈíü6Â∫¶ + ÁßíÊï∞ÂΩ±Âìç
            const hourAngle = (hours % 12) * 30 + minutes * 0.5 + seconds * 0.0083; // ÊØèÂ∞èÊó∂30Â∫¶ + ÂàÜÈíüÂΩ±Âìç
            
            // Êõ¥Êñ∞ÊåáÈíà‰ΩçÁΩÆ
            const hourHand = document.getElementById('hourHand');
            const minuteHand = document.getElementById('minuteHand');
            const secondHand = document.getElementById('secondHand');
            
            if (hourHand) {
                hourHand.style.transform = `rotate(${hourAngle}deg)`;
            }
            if (minuteHand) {
                minuteHand.style.transform = `rotate(${minuteAngle}deg)`;
            }
            if (secondHand) {
                secondHand.style.transform = `rotate(${secondAngle}deg)`;
            }
            
            // Êõ¥Êñ∞Êó•ÊúüÊòæÁ§∫ÔºàÊØèÁßíÊõ¥Êñ∞‰∏ÄÊ¨°Ôºâ
            if (seconds === 0) {
                const dateStr = beijingTime.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long'
                });
                
                const dateDisplay = document.getElementById('beijingDate');
                if (dateDisplay) {
                    dateDisplay.textContent = dateStr;
                }
            }
        }

        // Êó•ÂéÜÂäüËÉΩ
        let currentDate = new Date();
        const weekdays = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
        
        // Ê®°Êãü‰∫ã‰ª∂Êï∞ÊçÆÔºàÂÆûÈôÖÈ°πÁõÆ‰∏≠Â∫îËØ•‰ªéÂêéÁ´ØËé∑ÂèñÔºâ
        const eventsData = {
            '2024-01-15': [
                { time: '09:00', title: 'ÈòÖËØª„ÄäÊ∑±Â∫¶Â∑•‰Ωú„Äã', type: 'important' },
                { time: '14:00', title: 'Self-talk ÂèçÊÄù', type: 'normal' }
            ],
            '2024-01-16': [
                { time: '10:00', title: 'Ë°åÂä®È°πÂõûÈ°æ', type: 'normal' }
            ],
            '2024-01-20': [
                { time: '16:00', title: 'ÈáçË¶Å‰ºöËÆÆ', type: 'important' }
            ]
        };

        function initializeCalendar() {
            renderCalendar();
            
            // ÁÇπÂáªÊó•ÂéÜÂ§ñÁöÑÂå∫ÂüüÂÖ≥Èó≠‰∫ã‰ª∂ÂºπÁ™ó
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.calendar-day') && !e.target.closest('.event-popup')) {
                    closeEventPopup();
                }
            });
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Êõ¥Êñ∞Êúà‰ªΩÊòæÁ§∫
            const monthYearElement = document.getElementById('monthYear');
            if (monthYearElement) {
                monthYearElement.textContent = `${year}Âπ¥${month + 1}Êúà`;
            }
            
            // Ëé∑ÂèñÂΩìÊúàÁ¨¨‰∏ÄÂ§©ÂíåÊúÄÂêé‰∏ÄÂ§©
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const firstDayWeek = firstDay.getDay();
            const daysInMonth = lastDay.getDate();
            
            const calendarGrid = document.getElementById('calendarGrid');
            if (!calendarGrid) return;
            
            calendarGrid.innerHTML = '';
            
            // Ê∑ªÂä†ÊòüÊúüÊ†áÈ¢ò
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'weekday-header';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            // Ê∑ªÂä†‰∏äÊúàÊú´Â∞æÁöÑÊó•Êúü
            const prevMonth = new Date(year, month, 0);
            const daysInPrevMonth = prevMonth.getDate();
            
            for (let i = firstDayWeek - 1; i >= 0; i--) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.textContent = daysInPrevMonth - i;
                calendarGrid.appendChild(dayElement);
            }
            
            // Ê∑ªÂä†ÂΩìÊúàÊó•Êúü
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                // Ê†áËÆ∞‰ªäÂ§©
                const today = new Date();
                if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                    dayElement.classList.add('today');
                }
                
                // Ê£ÄÊü•ÊòØÂê¶Êúâ‰∫ã‰ª∂
                if (eventsData[dateKey]) {
                    const hasImportant = eventsData[dateKey].some(event => event.type === 'important');
                    if (hasImportant) {
                        dayElement.classList.add('important');
                    } else {
                        dayElement.classList.add('has-events');
                    }
                    
                    // Ê∑ªÂä†‰∫ã‰ª∂ÊåáÁ§∫Âô®
                    const indicator = document.createElement('div');
                    indicator.className = 'event-indicator';
                    if (dayElement.classList.contains('today')) {
                        indicator.classList.add('today');
                    }
                    dayElement.appendChild(indicator);
                }
                
                // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                dayElement.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showEventPopup(e, dateKey, eventsData[dateKey] || []);
                });
                
                calendarGrid.appendChild(dayElement);
            }
            
            // Ê∑ªÂä†‰∏ãÊúàÂºÄÂßãÊó•ÊúüÔºàÂ°´Êª°6Ë°åÔºâ
            const totalCells = 7 * 6; // 6Ë°å
            const currentCells = weekdays.length + firstDayWeek + daysInMonth;
            const remainingCells = totalCells - currentCells;
            
            for (let day = 1; day <= remainingCells; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.textContent = day;
                calendarGrid.appendChild(dayElement);
            }
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function showEventPopup(event, dateKey, events) {
            // ÂÖ≥Èó≠‰πãÂâçÁöÑÂºπÁ™ó
            closeEventPopup();
            
            if (events.length === 0) return;
            
            // ÂàõÂª∫ÂºπÁ™ó
            const popup = document.createElement('div');
            popup.className = 'event-popup show';
            popup.id = 'eventPopup';
            
            const dateStr = new Date(dateKey).toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            popup.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 10px; color: #667eea;">${dateStr}</div>
                ${events.map(event => `
                    <div class="event-item">
                        <span class="event-time">${event.time}</span>
                        <span class="event-title">${event.title}</span>
                    </div>
                `).join('')}
            `;
            
            // ÂÆö‰ΩçÂºπÁ™ó
            const rect = event.target.getBoundingClientRect();
            popup.style.position = 'fixed';
            popup.style.top = `${rect.bottom + 5}px`;
            popup.style.left = `${rect.left}px`;
            
            document.body.appendChild(popup);
        }

        function closeEventPopup() {
            const popup = document.getElementById('eventPopup');
            if (popup) {
                popup.remove();
            }
        }
        
        // ============= Êñ∞Â¢ûÁªÑ‰ª∂ÂäüËÉΩÂºÄÂßã =============
        
        // Êâ©Â±ïÂ§©Ê∞î‰ø°ÊÅØÂäüËÉΩ
        function initializeWeather() {
            // Ê®°ÊãüÂ§©Ê∞îÊï∞ÊçÆÔºàÂÆûÈôÖÈ°πÁõÆ‰∏≠Â∫îËØ•Ë∞ÉÁî®Â§©Ê∞îAPIÔºâ
            const weatherData = {
                icon: '‚òÄÔ∏è',
                temperature: '22¬∞C',
                condition: 'Êô¥Êúó',
                sunrise: '6:30',
                sunset: '18:20',
                humidity: '65%',
                windSpeed: '2m/s',
                type: 'sunny' // Áî®‰∫éÂä®ÁîªÈÄÇÈÖç
            };
            
            updateExtendedWeatherDisplay(weatherData);
            updateDynamicBackground(weatherData.type);
            
            // ÊØè2Â∞èÊó∂Êõ¥Êñ∞‰∏ÄÊ¨°Â§©Ê∞î
            setInterval(() => {
                // ËøôÈáåÂèØ‰ª•Ë∞ÉÁî®ÁúüÂÆûÁöÑÂ§©Ê∞îAPI
                updateExtendedWeatherDisplay(weatherData);
                updateDynamicBackground(weatherData.type);
            }, 2 * 60 * 60 * 1000);
        }

        function updateExtendedWeatherDisplay(weather) {
            const weatherIcon = document.getElementById('weatherIcon');
            const weatherTemp = document.getElementById('weatherTemp');
            const weatherCondition = document.getElementById('weatherCondition');
            const sunrise = document.getElementById('sunrise');
            const sunset = document.getElementById('sunset');
            const humidity = document.getElementById('humidity');
            const windSpeed = document.getElementById('windSpeed');
            
            if (weatherIcon) weatherIcon.textContent = weather.icon;
            if (weatherTemp) weatherTemp.textContent = weather.temperature;
            if (weatherCondition) weatherCondition.textContent = weather.condition;
            if (sunrise) sunrise.textContent = weather.sunrise;
            if (sunset) sunset.textContent = weather.sunset;
            if (humidity) humidity.textContent = weather.humidity;
            if (windSpeed) windSpeed.textContent = weather.windSpeed;
        }

        function updateDynamicBackground(weatherType) {
            const dynamicBackground = document.getElementById('dynamicBackground');
            if (!dynamicBackground) return;

            // ÁßªÈô§‰πãÂâçÁöÑÂ§©Ê∞îÁ±ª
            dynamicBackground.classList.remove('sunny', 'rainy', 'cloudy', 'snowy');
            
            // Ê∑ªÂä†Êñ∞ÁöÑÂ§©Ê∞îÁ±ª
            dynamicBackground.classList.add(weatherType);
            
            // Ê†πÊçÆÊó∂Èó¥Ë∞ÉÊï¥Âä®Áîª
            const hour = new Date().getHours();
            adjustAnimationByTime(hour);
        }

        function adjustAnimationByTime(hour) {
            const shapes = document.querySelectorAll('.shape');
            
            // Ê†πÊçÆÊó∂Èó¥Ë∞ÉÊï¥Âä®ÁîªÈÄüÂ∫¶ÂíåÈÄèÊòéÂ∫¶
            if (hour >= 6 && hour < 12) {
                // Êó©Êô®ÔºöÂä®ÁîªËæÉÂø´ÔºåÈÄèÊòéÂ∫¶ËæÉÈ´ò
                shapes.forEach(shape => {
                    shape.style.animationDuration = '6s';
                    shape.style.opacity = '0.8';
                });
            } else if (hour >= 12 && hour < 18) {
                // ‰∏≠ÂçàÔºöÂä®ÁîªÊ≠£Â∏∏ÔºåÈÄèÊòéÂ∫¶‰∏≠Á≠â
                shapes.forEach(shape => {
                    shape.style.animationDuration = '8s';
                    shape.style.opacity = '0.6';
                });
            } else if (hour >= 18 && hour < 22) {
                // ÂÇçÊôöÔºöÂä®ÁîªËæÉÊÖ¢ÔºåÈÄèÊòéÂ∫¶ËæÉ‰Ωé
                shapes.forEach(shape => {
                    shape.style.animationDuration = '10s';
                    shape.style.opacity = '0.4';
                });
            } else {
                // Â§úÊôöÔºöÂä®ÁîªÂæàÊÖ¢ÔºåÈÄèÊòéÂ∫¶Âæà‰Ωé
                shapes.forEach(shape => {
                    shape.style.animationDuration = '12s';
                    shape.style.opacity = '0.2';
                });
            }
        }

        // Êô∫ËÉΩÂ§©Ê∞îÁ±ªÂûãÊ£ÄÊµã
        function getWeatherTypeFromCondition(condition) {
            if (condition.includes('Êô¥') || condition.includes('sunny')) return 'sunny';
            if (condition.includes('Èõ®') || condition.includes('rain')) return 'rainy';
            if (condition.includes('‰∫ë') || condition.includes('cloud')) return 'cloudy';
            if (condition.includes('Èõ™') || condition.includes('snow')) return 'snowy';
            return 'sunny'; // ÈªòËÆ§
        }

        // Â§©Ê∞îÊºîÁ§∫ÂäüËÉΩÔºàÂèØÈÄâÔºâ
        function addWeatherDemoFeature() {
            // Ê∑ªÂä†‰∏Ä‰∏™ÈöêËóèÁöÑÂ§©Ê∞îÂàáÊç¢ÊåâÈíÆÔºàÂèåÂáªÊ†áÈ¢òÂèØ‰ª•ÂàáÊç¢Â§©Ê∞îÔºâ
            const weatherTitle = document.querySelector('.clock-widget h3');
            if (weatherTitle) {
                let clickCount = 0;
                weatherTitle.style.cursor = 'pointer';
                weatherTitle.title = 'ÂèåÂáªÂàáÊç¢Â§©Ê∞îÊºîÁ§∫';
                
                weatherTitle.addEventListener('click', () => {
                    clickCount++;
                    if (clickCount === 1) {
                        setTimeout(() => {
                            clickCount = 0;
                        }, 300);
                    } else if (clickCount === 2) {
                        cycleWeatherDemo();
                        clickCount = 0;
                    }
                });
            }
        }

        // Âæ™ÁéØÂàáÊç¢Â§©Ê∞îÊºîÁ§∫
        function cycleWeatherDemo() {
            const weatherTypes = ['sunny', 'rainy', 'cloudy', 'snowy'];
            const weatherData = {
                sunny: {
                    icon: '‚òÄÔ∏è', temperature: '22¬∞C', condition: 'Êô¥Êúó',
                    sunrise: '6:30', sunset: '18:20', humidity: '65%', windSpeed: '2m/s'
                },
                rainy: {
                    icon: 'üåßÔ∏è', temperature: '18¬∞C', condition: 'Â∞èÈõ®',
                    sunrise: '6:45', sunset: '18:05', humidity: '85%', windSpeed: '3m/s'
                },
                cloudy: {
                    icon: '‚òÅÔ∏è', temperature: '20¬∞C', condition: 'Â§ö‰∫ë',
                    sunrise: '6:35', sunset: '18:15', humidity: '70%', windSpeed: '2.5m/s'
                },
                snowy: {
                    icon: '‚ùÑÔ∏è', temperature: '-5¬∞C', condition: 'Â∞èÈõ™',
                    sunrise: '7:00', sunset: '17:50', humidity: '90%', windSpeed: '1m/s'
                }
            };

            let currentIndex = 0;
            const interval = setInterval(() => {
                const weatherType = weatherTypes[currentIndex];
                const data = weatherData[weatherType];
                
                updateExtendedWeatherDisplay(data);
                updateDynamicBackground(weatherType);
                
                currentIndex = (currentIndex + 1) % weatherTypes.length;
                
                if (currentIndex === 0) {
                    clearInterval(interval);
                    // ÂõûÂà∞ÂéüÂßãÂ§©Ê∞î
                    const originalData = {
                        icon: '‚òÄÔ∏è', temperature: '22¬∞C', condition: 'Êô¥Êúó',
                        sunrise: '6:30', sunset: '18:20', humidity: '65%', windSpeed: '2m/s'
                    };
                    setTimeout(() => {
                        updateExtendedWeatherDisplay(originalData);
                        updateDynamicBackground('sunny');
                    }, 1000);
                }
            }, 2000);
        }

        // ‰ªäÊó•ÁªüËÆ°ÂäüËÉΩ
        function initializeTodayStats() {
            // Ê®°Êãü‰ªäÊó•Êï∞ÊçÆÔºàÂÆûÈôÖÈ°πÁõÆ‰∏≠Â∫îËØ•‰ªéÂêéÁ´ØAPIËé∑ÂèñÔºâ
            const todayStats = {
                readingTime: '2Â∞èÊó∂30ÂàÜ',
                completedActions: '3/5',
                practiceCount: '7Ê¨°'
            };
            
            updateTodayStats(todayStats);
            
            // ÊØèÂàÜÈíüÊõ¥Êñ∞‰∏ÄÊ¨°ÔºàÂÆûÈôÖÈ°πÁõÆ‰∏≠ÂèØ‰ª•ËÆæÁΩÆÊõ¥ÂêàÈÄÇÁöÑÊõ¥Êñ∞È¢ëÁéáÔºâ
            setInterval(() => {
                updateTodayStats(todayStats);
            }, 60000);
        }

        function updateTodayStats(stats) {
            const readingTime = document.getElementById('todayReadingTime');
            const completedActions = document.getElementById('completedActions');
            const practiceCount = document.getElementById('practiceCount');
            
            if (readingTime) readingTime.textContent = stats.readingTime;
            if (completedActions) completedActions.textContent = stats.completedActions;
            if (practiceCount) practiceCount.textContent = stats.practiceCount;
        }

        // ‰∏™‰∫∫ÁªüËÆ°ÂäüËÉΩ
        function initializePersonalStats() {
            // Ê®°Êãü‰∏™‰∫∫ÁªüËÆ°Êï∞ÊçÆ
            const personalStats = {
                weeklyGoal: '85%',
                streakDays: '7Â§©',
                successRate: '78%'
            };
            
            updatePersonalStats(personalStats);
            
            // ÊØèÂ∞èÊó∂Êõ¥Êñ∞‰∏ÄÊ¨°
            setInterval(() => {
                updatePersonalStats(personalStats);
            }, 60 * 60 * 1000);
        }

        function updatePersonalStats(stats) {
            const weeklyGoal = document.getElementById('weeklyGoal');
            const streakDays = document.getElementById('streakDays');
            const successRate = document.getElementById('successRate');
            
            if (weeklyGoal) weeklyGoal.textContent = stats.weeklyGoal;
            if (streakDays) streakDays.textContent = stats.streakDays;
            if (successRate) successRate.textContent = stats.successRate;
        }

        // Âø´ÈÄüÊìç‰ΩúÂäüËÉΩ
        function startReading() {
            showMessage('ÂºÄÂßãÈòÖËØªÊ®°Âºè...', 'success');
            // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÂÆûÈôÖÁöÑÈòÖËØªÂäüËÉΩ
            setTimeout(() => {
                navigateTo('upload');
            }, 1000);
        }

        function recordSelfTalk() {
            showMessage('ÂáÜÂ§áÂºÄÂßãSelf-talk...', 'success');
            setTimeout(() => {
                goToSelfTalk();
            }, 1000);
        }

        function addAction() {
            showMessage('ÂáÜÂ§áÊ∑ªÂä†Ë°åÂä®È°π...', 'success');
            setTimeout(() => {
                navigateTo('actions');
            }, 1000);
        }

        function viewDashboard() {
            showMessage('Ë∑≥ËΩ¨Âà∞Êï∞ÊçÆ‰ª™Ë°®Áõò...', 'success');
            setTimeout(() => {
                goToDashboard();
            }, 1000);
        }

        // ÂæÖÂäû‰∫ãÈ°πÂäüËÉΩ
        function initializeTodos() {
            const todoChecks = document.querySelectorAll('.todo-check');
            todoChecks.forEach(check => {
                check.addEventListener('click', function() {
                    const todoItem = this.closest('.todo-item');
                    const todoText = todoItem.querySelector('.todo-text');
                    
                    if (this.textContent === '‚úì') {
                        this.textContent = '‚úì';
                        this.style.background = '#28a745';
                        todoText.style.textDecoration = 'line-through';
                        todoText.style.opacity = '0.6';
                        showMessage('‰ªªÂä°Â∑≤ÂÆåÊàêÔºÅ', 'success');
                    }
                });
            });
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñÂæÖÂäû‰∫ãÈ°π
        document.addEventListener('DOMContentLoaded', function() {
            initializeTodos();
            initializeUserCenter();
        });
        
        // ============= Êñ∞Â¢ûÁªÑ‰ª∂ÂäüËÉΩÁªìÊùü =============
        
        // ============= Êó∂ÈíüÂíåÊó•ÂéÜÂäüËÉΩÁªìÊùü =============
        
        // ÊòæÁ§∫Ê∂àÊÅØ
        function showMessage(message, type = 'info') {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="${type}">${message}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }
        
        // API ËØ∑Ê±ÇÂ∞ÅË£Ö
        async function apiRequest(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                },
                ...options
            };
            
            // ÊØèÊ¨°ËØ∑Ê±ÇÂâçÈáçÊñ∞Ëé∑ÂèñÊúÄÊñ∞ÁöÑ authToken
            const currentToken = localStorage.getItem('authToken');
            if (currentToken) {
                config.headers['Authorization'] = `Bearer ${currentToken}`;
            }
            
            try {
                const response = await fetch(url, config);
                if (!response.ok) {
                    // Âè™ÊúâËÆ§ËØÅÈîôËØØÊâçËß¶ÂèëÁôªÂΩïÂºπÁ™ó
                    if (response.status === 401 || response.status === 403) {
                        authToken = null;
                        localStorage.removeItem('authToken');
                        localStorage.removeItem('userEmail');
                        showAuthModal();
                    }
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                console.error('API ËØ∑Ê±ÇÂ§±Ë¥•:', error);
                
                // Â§ÑÁêÜÁΩëÁªúÈîôËØØ
                if (error.message.includes('Failed to fetch')) {
                    showMessage('ÁΩëÁªúËøûÊé•ÈîôËØØÔºåËØ∑Ê£ÄÊü•ÁΩëÁªú', 'error');
                } else if (!error.message.includes('ËÆ§ËØÅÂ§±Êïà')) {
                    // ÈùûËÆ§ËØÅÈîôËØØ‰∏çÊòæÁ§∫ÂÖ∑‰ΩìÈîôËØØ‰ø°ÊÅØÔºåÈÅøÂÖçÁî®Êà∑Âõ∞ÊÉë
                    console.log('ËØ∑Ê±ÇÂ§±Ë¥•ËØ¶ÊÉÖ:', error.message);
                }
                
                throw error;
            }
        }
        
        // ÊòæÁ§∫ËÆ§ËØÅÊ®°ÊÄÅÊ°Ü
        function showAuthModal() {
            // ÈÅøÂÖçÂú®È°µÈù¢Âä†ËΩΩÊó∂ÊòæÁ§∫ÁôªÂΩïÊ°Ü
            if (document.readyState === 'loading') {
                return;
            }
            document.getElementById('authModal').classList.remove('hidden');
        }
        
        // ÂÖ≥Èó≠ËÆ§ËØÅÊ®°ÊÄÅÊ°Ü
        function closeAuthModal() {
            document.getElementById('authModal').classList.add('hidden');
        }
        
        // ÂàáÊç¢ÁôªÂΩï/Ê≥®ÂÜåÊ†áÁ≠æ
        function switchTab(tab) {
            // Êõ¥Êñ∞Ê†áÁ≠æÁä∂ÊÄÅ
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');
            
            // Êõ¥Êñ∞Ë°®ÂçïÊòæÁ§∫
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            document.getElementById(tab + 'Form').classList.add('active');
        }
        
        // Áî®Êà∑ÁôªÂΩï
        async function login(email, password) {
            try {
                const response = await apiRequest('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });
                
                authToken = response.access_token;
                localStorage.setItem('authToken', authToken);
                localStorage.setItem('userEmail', email);
                
                showMessage('ÁôªÂΩïÊàêÂäüÔºÅ', 'success');
                closeAuthModal();
                updateUserInfo(email);
                loadActions();
                // Â¶ÇÊûúÂΩìÂâçÂú®‰ª™Ë°®ÁõòÈ°µÈù¢ÔºåÂà∑Êñ∞‰ª™Ë°®ÁõòÊï∞ÊçÆ
                if (typeof loadCurrentViewData === 'function') {
                    loadCurrentViewData();
                }
                return true;
            } catch (error) {
                showMessage('ÁôªÂΩïÂ§±Ë¥•: ' + error.message, 'error');
                return false;
            }
        }
        
        // Áî®Êà∑Ê≥®ÂÜå
        async function register(email, password, name) {
            try {
                await apiRequest('/auth/register', {
                    method: 'POST',
                    body: JSON.stringify({ 
                        email, 
                        password, 
                        name: name || email.split('@')[0] 
                    })
                });
                
                showMessage('Ê≥®ÂÜåÊàêÂäüÔºÅÊ≠£Âú®Ëá™Âä®ÁôªÂΩï...', 'success');
                
                // Ê≥®ÂÜåÊàêÂäüÂêéËá™Âä®ÁôªÂΩï
                return await login(email, password);
            } catch (error) {
                showMessage('Ê≥®ÂÜåÂ§±Ë¥•: ' + error.message, 'error');
                return false;
            }
        }
        
        // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØÊòæÁ§∫
        function updateUserInfo(email) {
            const userInfo = document.getElementById('userInfo');
            const userEmail = document.getElementById('userEmail');
            
            if (email) {
                userEmail.textContent = email;
                userInfo.classList.add('show');
            } else {
                userInfo.classList.remove('show');
            }
        }
        
        // ÈÄÄÂá∫ÁôªÂΩï
        function logout() {
            authToken = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('userEmail');
            updateUserInfo(null);
            showMessage('Â∑≤ÈÄÄÂá∫ÁôªÂΩï', 'info');
            showAuthModal();
        }
        
        // Ê£ÄÊü•ËÆ§ËØÅÁä∂ÊÄÅ
        async function checkAuth() {
            // ÈáçÊñ∞Ëé∑ÂèñÊúÄÊñ∞ÁöÑ authToken
            authToken = localStorage.getItem('authToken');
            if (authToken) {
                const email = localStorage.getItem('userEmail');
                
                // Â¶ÇÊûúÊúâtokenÂíåemailÔºåÂÖàÊõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØÔºåÈÅøÂÖçÊòæÁ§∫ÁôªÂΩïÊ°Ü
                if (email) {
                    updateUserInfo(email);
                }
                
                // ÊÄªÊòØÈ™åËØÅtokenÊúâÊïàÊÄßÔºåÁ°Æ‰øùtokenÊú™ËøáÊúü
                try {
                    const response = await fetch(`${API_BASE}/auth/me`, {
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });
                    
                    if (response.ok) {
                        const userData = await response.json();
                        localStorage.setItem('userEmail', userData.email);
                        updateUserInfo(userData.email);
                        loadActions();
                        // Â¶ÇÊûúÂΩìÂâçÂú®‰ª™Ë°®ÁõòÈ°µÈù¢ÔºåÂà∑Êñ∞‰ª™Ë°®ÁõòÊï∞ÊçÆ
                        if (typeof loadCurrentViewData === 'function') {
                            loadCurrentViewData();
                        }
                        closeAuthModal();
                        return true;
                    } else {
                        // Token Êó†ÊïàÔºåÊ∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®
                        authToken = null;
                        localStorage.removeItem('authToken');
                        localStorage.removeItem('userEmail');
                        updateUserInfo(null);
                        showAuthModal();
                        return false;
                    }
                } catch (error) {
                    console.error('ËÆ§ËØÅÊ£ÄÊü•Â§±Ë¥•:', error);
                    // ÁΩëÁªúÈîôËØØÊó∂ÔºåÂ¶ÇÊûúÊú¨Âú∞ÊúâemailÔºå‰øùÊåÅÁôªÂΩïÁä∂ÊÄÅ
                    if (email) {
                        console.log('ÁΩëÁªúÈîôËØØÔºå‰øùÊåÅÊú¨Âú∞ÁôªÂΩïÁä∂ÊÄÅ');
                        return true;
                    } else {
                        showAuthModal();
                        return false;
                    }
                }
            } else {
                showAuthModal();
                return false;
            }
        }
        
        // ‰∏ä‰º†Á¨îËÆ∞Âπ∂ÊäΩÂèñË°åÂä®È°π
        async function uploadNotes() {
            const bookTitle = document.getElementById('bookTitle').value.trim();
            const notesContent = document.getElementById('notesContent').value.trim();
            
            if (!notesContent) {
                showMessage('ËØ∑ËæìÂÖ•Á¨îËÆ∞ÂÜÖÂÆπ', 'error');
                return;
            }
            
            const uploadBtn = document.getElementById('uploadBtn');
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'üîÑ Ê≠£Âú®ÊäΩÂèñ...';
            
            try {
                const response = await apiRequest('/api/actions/upload-notes', {
                    method: 'POST',
                    body: JSON.stringify({
                        content: notesContent,
                        book_title: bookTitle || undefined
                    })
                });
                
                showMessage(response.message, 'success');
                document.getElementById('bookTitle').value = '';
                document.getElementById('notesContent').value = '';
                
                // Âà∑Êñ∞Ë°åÂä®È°πÂàóË°®
                loadActions();
                // Â¶ÇÊûúÂΩìÂâçÂú®‰ª™Ë°®ÁõòÈ°µÈù¢ÔºåÂà∑Êñ∞‰ª™Ë°®ÁõòÊï∞ÊçÆ
                if (typeof loadCurrentViewData === 'function') {
                    loadCurrentViewData();
                }
            } catch (error) {
                showMessage('ÊäΩÂèñÂ§±Ë¥•: ' + error.message, 'error');
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'üöÄ ÊäΩÂèñË°åÂä®È°π';
            }
        }
        
        // Âä†ËΩΩË°åÂä®È°πÂàóË°®
        async function loadActions() {
            try {
                const response = await apiRequest('/api/actions/');
                allActions = response.items; // Â≠òÂÇ®ÊâÄÊúâË°åÂä®È°π
                renderActions(); // Ê∏≤ÊüìË°åÂä®È°π
            } catch (error) {
                document.getElementById('actionsList').innerHTML = 
                    '<div class="error">Âä†ËΩΩÂ§±Ë¥•: ' + error.message + '</div>';
            }
        }
        
        // Ê∏≤ÊüìË°åÂä®È°πÂàóË°®
        function renderActions() {
            const actionsList = document.getElementById('actionsList');
            
            if (allActions.length === 0) {
                actionsList.innerHTML = '<div class="loading">ÊöÇÊó†Ë°åÂä®È°π</div>';
                return;
            }
            
            // Ê†πÊçÆÂΩìÂâçÁ≠õÈÄâÁ±ªÂûãËøáÊª§Ë°åÂä®È°π
            let filteredActions = allActions;
            if (currentFilterType !== 'all') {
                filteredActions = allActions.filter(action => action.action_type === currentFilterType);
            }
            
            if (filteredActions.length === 0) {
                actionsList.innerHTML = `<div class="loading">ÊöÇÊó†${getActionTypeText(currentFilterType)}Ë°åÂä®È°π</div>`;
                return;
            }
            
            actionsList.innerHTML = filteredActions.map(action => {
                const actionType = action.action_type || 'trigger';
                const isHabit = actionType === 'habit';
                
                return `
                <div class="action-item">
                    <h3>${action.action_text} 
                        <span class="status-badge status-${action.status}">${getStatusText(action.status)}</span>
                    </h3>
                    <p><strong>üìñ Êù•Ê∫ê:</strong> ${action.book_title}</p>
                    <p><strong>üìù ÂéüÊñá:</strong> ${action.source_excerpt}</p>
                    <p><strong>üéØ Á±ªÂûã:</strong> ${getActionTypeText(actionType)}</p>
                    <p><strong>‚è∞ Êó∂Èó¥ÁÆ°ÁêÜ:</strong> ${getDurationInfo(action)}</p>
                    <div class="action-tags">
                        ${action.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    <div class="action-buttons">
                        ${isHabit ? 
                            `<button class="btn-small btn-time-management" onclick="showTimeManagementModal(${action.id})" style="background: #28a745; color: white;">
                                ‚è∞ ËÆæÁΩÆÊó∂Èó¥
                            </button>` :
                            `<button class="btn-small btn-time-management" onclick="showCountAndDaysModal(${action.id})" style="background: #28a745; color: white;">
                                üìä ËÆæÁΩÆÊ¨°Êï∞ÂíåÂ§©Êï∞
                            </button>`
                        }
                        <button class="btn-small btn-log" onclick="showPracticeModal(${action.id})">
                            üìù ËÆ∞ÂΩïÂÆûË∑µÂèçÈ¶à
                        </button>
                        <button class="btn-small" onclick="showPracticeLogsModal(${action.id})" style="background: #6c757d; color: white;">
                            üìã Êü•ÁúãËÆ∞ÂΩï
                        </button>
                        <button class="btn-small" onclick="openAIAdvice(${action.id})" style="background: #9c27b0; color: white;">
                            ü§ñ AIÂª∫ËÆÆ
                        </button>
                        <button class="btn-small" onclick="showEditActionModal(${action.id})" style="background: #17a2b8; color: white;">
                            ‚úèÔ∏è ÁºñËæë
                        </button>
                        <button class="btn-small" onclick="deleteAction(${action.id})" style="background: #dc3545; color: white;">
                            üóëÔ∏è Âà†Èô§
                        </button>
                    </div>
                </div>
                `;
            }).join('');
        }
        
        // ÊåâÁ±ªÂûãÁ≠õÈÄâË°åÂä®È°π
        function filterActionsByType(type) {
            currentFilterType = type;
            
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('.action-type-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('active');
            
            // ÊéßÂà∂ÊâπÈáèËÆæÁΩÆÊåâÈíÆÊòæÁ§∫
            const batchTimeBtn = document.getElementById('batchTimeBtn');
            if (type === 'all' || type === 'habit') {
                // Ê£ÄÊü•ÊòØÂê¶Êúâ‰π†ÊÉØÂûãË°åÂä®È°π
                const hasHabitActions = allActions.some(action => action.action_type === 'habit');
                batchTimeBtn.style.display = hasHabitActions ? 'block' : 'none';
            } else {
                batchTimeBtn.style.display = 'none';
            }
            
            // ÈáçÊñ∞Ê∏≤Êüì
            renderActions();
        }
        
        // Ëé∑ÂèñË°åÂä®Á±ªÂûãÊñáÊú¨
        function getActionTypeText(type) {
            const typeMap = {
                'trigger': 'ÊÉÖÂ¢ÉËß¶ÂèëÂûã',
                'habit': '‰π†ÊÉØÂÖªÊàêÂûã',
                'all': 'ÂÖ®ÈÉ®'
            };
            return typeMap[type] || 'ÊÉÖÂ¢ÉËß¶ÂèëÂûã';
        }
        
        // ‰ª™Ë°®ÁõòÊï∞ÊçÆÂä†ËΩΩÁé∞Âú®Áî± static/dashboard.js ‰∏≠ÁöÑ loadDashboard() Â§ÑÁêÜ
        // Ê≠§Â§ÑÂéüÊúâÁöÑ loadDashboard() ÂáΩÊï∞Â∑≤ÁßªÈô§ÔºåÂõ†‰∏∫ÂÆÉË∞ÉÁî®‰∫Ü‰∏çÂ≠òÂú®ÁöÑAPI
        
        // Âä†ËΩΩÊó∂Èó¥Áª¥Â∫¶ÂàÜÊûê
        async function loadDurationAnalytics() {
            try {
                const response = await apiRequest('/api/dashboard/duration-analytics');
                
                document.getElementById('shortTermActions').textContent = response.short_term_actions;
                document.getElementById('longTermActions').textContent = response.long_term_actions;
                document.getElementById('lifetimeActions').textContent = response.lifetime_actions;
            } catch (error) {
                console.error('Âä†ËΩΩÊó∂Èó¥Áª¥Â∫¶ÂàÜÊûêÂ§±Ë¥•:', error);
            }
        }
        
        // Âä†ËΩΩÂùöÊåÅÂ∫¶ÂàÜÊûê
        async function loadStreakAnalytics() {
            try {
                const response = await apiRequest('/api/dashboard/streak-analytics');
                
                document.getElementById('currentStreak').textContent = response.current_streak_days;
                
                // ÊòæÁ§∫ÂùöÊåÅÂ∫¶ËØ¶ÊÉÖ
                if (response.streak_actions.length > 0) {
                    const streakAnalysis = document.getElementById('streakAnalysis');
                    const streakDetails = document.getElementById('streakDetails');
                    
                    streakAnalysis.style.display = 'block';
                    
                    streakDetails.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 20px;">
                            ${response.streak_actions.slice(0, 6).map(action => `
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
                                    <h4 style="margin-bottom: 8px; color: #333;">${action.action_text}</h4>
                                    <div style="font-size: 14px; color: #666;">
                                        <div>üî• ÂΩìÂâçËøûÁª≠: ${action.current_streak} Â§©</div>
                                        <div>üèÜ ÊúÄÈïøËøûÁª≠: ${action.longest_streak} Â§©</div>
                                        <div>üìä ÊÄªÂÆûË∑µ: ${action.total_practices} Ê¨°</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Âä†ËΩΩÂùöÊåÅÂ∫¶ÂàÜÊûêÂ§±Ë¥•:', error);
            }
        }
        
        // Ëé∑ÂèñÁä∂ÊÄÅÊñáÊú¨
        function getStatusText(status) {
            const statusMap = {
                'todo': 'ÂæÖÂäû',
                'in_progress': 'ËøõË°å‰∏≠',
                'done': 'Â∑≤ÂÆåÊàê'
            };
            return statusMap[status] || status;
        }
        
        // Ëé∑ÂèñÊó∂Èó¥ÁÆ°ÁêÜ‰ø°ÊÅØ
        function getDurationInfo(action) {
            const actionType = action.action_type || 'trigger';
            
            if (actionType === 'habit') {
                // ‰π†ÊÉØÂûãÔºöÊòæÁ§∫‰º†ÁªüÁöÑÊó∂Èó¥ÁÆ°ÁêÜ‰ø°ÊÅØ
                const durationTypeMap = {
                    'short_term': 'Áü≠Êúü',
                    'long_term': 'ÈïøÊúü',
                    'lifetime': 'ÁªàË∫´'
                };
                
                const frequencyMap = {
                    'daily': 'ÊØèÂ§©',
                    'weekly': 'ÊØèÂë®',
                    'monthly': 'ÊØèÊúà',
                    'custom': 'Ëá™ÂÆö‰πâ'
                };
                
                let info = durationTypeMap[action.duration_type] || 'Áü≠Êúü';
                
                if (action.target_duration_days) {
                    info += ` (${action.target_duration_days}Â§©)`;
                }
                
                if (action.target_frequency) {
                    const freq = frequencyMap[action.target_frequency] || action.target_frequency;
                    if (action.target_frequency === 'custom' && action.custom_frequency_days) {
                        info += ` | ÊØè${action.custom_frequency_days}Â§©`;
                    } else {
                        info += ` | ${freq}`;
                    }
                }
                
                if (action.start_date) {
                    info += ` | ÂºÄÂßã: ${new Date(action.start_date).toLocaleDateString()}`;
                }
                
                return info;
            } else {
                // ÊÉÖÂ¢ÉÂûãÔºöÊòæÁ§∫Ê¨°Êï∞ÂíåÂ§©Êï∞‰ø°ÊÅØ
                let info = 'ÁõÆÊ†áÂÆåÊàê';
                
                if (action.target_duration_days) {
                    info += ` ${action.target_duration_days}Ê¨°`;
                }
                
                if (action.custom_frequency_days) {
                    info += ` | ${action.custom_frequency_days}Â§©ÂÜÖ`;
                }
                
                if (action.start_date) {
                    info += ` | ÂºÄÂßã: ${new Date(action.start_date).toLocaleDateString()}`;
                }
                
                if (action.end_date) {
                    info += ` | ÁªìÊùü: ${new Date(action.end_date).toLocaleDateString()}`;
                }
                
                return info;
            }
        }
        
        // ÁºñËæëË°åÂä®È°πÔºàÂç†‰ΩçÂáΩÊï∞Ôºâ
        
        // ÊòæÁ§∫ÂÆûË∑µËÆ∞ÂΩïÊ®°ÊÄÅÊ°Ü
        let currentActionId = null;
        
        async function showPracticeModal(actionId) {
            currentActionId = actionId;
            document.getElementById('practiceModal').classList.remove('hidden');
            
            // ËÆæÁΩÆÈªòËÆ§Êó•Êúü‰∏∫‰ªäÂ§©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('practiceDate').value = today;
            
            // ÈáçÁΩÆË°®Âçï
            document.getElementById('practiceForm').reset();
            document.getElementById('practiceDate').value = today;
            resetRating();
            
            // Ëé∑ÂèñË°åÂä®È°π‰ø°ÊÅØÔºåÂà§Êñ≠ÊòØÂê¶‰∏∫ÊÉÖÂ¢ÉÂûã
            try {
                const response = await apiRequest('/api/actions/');
                const action = response.items.find(a => a.id === actionId);
                
                if (action && action.action_type === 'trigger') {
                    // ÊÉÖÂ¢ÉÂûãÔºöÊòæÁ§∫Ê¨°Êï∞ËæìÂÖ•
                    document.getElementById('practiceCountGroup').style.display = 'block';
                    
                    // Ëá™Âä®Â°´ÂÖÖÂª∫ËÆÆÁöÑÊ¨°Êï∞ÔºàÂü∫‰∫éÂ∑≤ÊúâËÆ∞ÂΩïÁöÑÊúÄÂ§ßattempt_number+1Ôºâ
                    const existingLogs = await getExistingPracticeLogs(actionId);
                    const maxAttempt = Math.max(0, ...existingLogs.map(log => log.attempt_number || 0));
                    const suggestedCount = maxAttempt + 1;
                    document.getElementById('practiceCount').value = suggestedCount;
                } else {
                    // ‰π†ÊÉØÂûãÔºöÈöêËóèÊ¨°Êï∞ËæìÂÖ•
                    document.getElementById('practiceCountGroup').style.display = 'none';
                }
            } catch (error) {
                console.error('Ëé∑ÂèñË°åÂä®È°π‰ø°ÊÅØÂ§±Ë¥•:', error);
                // ÈªòËÆ§ÈöêËóèÊ¨°Êï∞ËæìÂÖ•
                document.getElementById('practiceCountGroup').style.display = 'none';
            }
        }
        
        // Ëé∑ÂèñÁé∞ÊúâÂÆûË∑µËÆ∞ÂΩïÔºàÁî®‰∫éÊÉÖÂ¢ÉÂûãÂª∫ËÆÆÊ¨°Êï∞Ôºâ
        async function getExistingPracticeLogs(actionId) {
            try {
                const response = await apiRequest(`/api/actions/${actionId}/practice-logs?size=1000`);
                return response.items || [];
            } catch (error) {
                console.error('Ëé∑ÂèñÂÆûË∑µËÆ∞ÂΩïÂ§±Ë¥•:', error);
                return [];
            }
        }
        
        // ÊòæÁ§∫ÂÆûË∑µËÆ∞ÂΩïÊü•ÁúãÊ®°ÊÄÅÊ°Ü
        let currentActionForLogs = null;
        
        async function showPracticeLogsModal(actionId) {
            currentActionForLogs = actionId;
            document.getElementById('practiceLogsModal').classList.remove('hidden');
            
            // Ëé∑ÂèñË°åÂä®È°π‰ø°ÊÅØ
            try {
                const response = await apiRequest('/api/actions/');
                const action = response.items.find(a => a.id === actionId);
                
                if (action) {
                    document.getElementById('practiceLogsSubtitle').textContent = 
                        `Êü•Áúã"${action.action_text}"ÁöÑÊâÄÊúâÂÆûË∑µÂèçÈ¶àËÆ∞ÂΩï`;
                }
            } catch (error) {
                console.error('Ëé∑ÂèñË°åÂä®È°π‰ø°ÊÅØÂ§±Ë¥•:', error);
            }
            
            // Âä†ËΩΩÂÆûË∑µËÆ∞ÂΩï
            await loadPracticeLogs(actionId);
        }
        
        function closePracticeLogsModal() {
            document.getElementById('practiceLogsModal').classList.add('hidden');
            currentActionForLogs = null;
        }
        
        async function loadPracticeLogs(actionId) {
            try {
                // Ëé∑ÂèñÊâÄÊúâÂÆûË∑µËÆ∞ÂΩïÔºàËÆæÁΩÆËæÉÂ§ßÁöÑsizeÁ°Æ‰øùËé∑ÂèñÊâÄÊúâËÆ∞ÂΩïÔºâ
                const response = await apiRequest(`/api/actions/${actionId}/practice-logs?size=1000`);
                const logsList = document.getElementById('practiceLogsList');
                
                if (response.items.length === 0) {
                    logsList.innerHTML = '<div class="loading">ÊöÇÊó†ÂÆûË∑µËÆ∞ÂΩï</div>';
                    return;
                }
                
                // Ëé∑ÂèñË°åÂä®È°πÁ±ªÂûã
                const actionsResponse = await apiRequest('/api/actions/');
                const action = actionsResponse.items.find(a => a.id === actionId);
                const isTrigger = action && action.action_type === 'trigger';
                
                logsList.innerHTML = response.items.map(log => {
                    const resultIcon = {
                        'success': '‚úÖ',
                        'partial': '‚ö†Ô∏è',
                        'fail': '‚ùå'
                    }[log.result] || '‚ùì';
                    
                    const ratingStars = log.rating ? '‚òÖ'.repeat(log.rating) + '‚òÜ'.repeat(5 - log.rating) : 'Êú™ËØÑÂàÜ';
                    
                    return `
                        <div class="practice-log-item" style="background: #f8f9fa; border-radius: 8px; padding: 15px; margin-bottom: 15px; border-left: 4px solid #667eea;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                <div>
                                    <h4 style="margin: 0; color: #333;">
                                        ${resultIcon} ${log.result === 'success' ? 'ÊàêÂäüÂÆåÊàê' : log.result === 'partial' ? 'ÈÉ®ÂàÜÂÆåÊàê' : 'Êú™ÂÆåÊàê'}
                                        ${isTrigger && log.attempt_number ? ` - Á¨¨${log.attempt_number}Ê¨°` : ''}
                                    </h4>
                                    <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">
                                        ${new Date(log.date).toLocaleDateString()} ${new Date(log.created_at).toLocaleTimeString()}
                                    </p>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: #ffd700; font-size: 16px;">${ratingStars}</div>
                                    ${log.success_score ? `<div style="font-size: 12px; color: #666;">ÊàêÂäüÂàÜÊï∞: ${log.success_score.toFixed(2)}</div>` : ''}
                                </div>
                            </div>
                            ${log.notes ? `<p style="margin: 10px 0 0 0; color: #555; font-style: italic;">"${log.notes}"</p>` : ''}
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                document.getElementById('practiceLogsList').innerHTML = 
                    '<div class="error">Âä†ËΩΩËÆ∞ÂΩïÂ§±Ë¥•: ' + error.message + '</div>';
            }
        }
        
        // ÂÖ≥Èó≠ÂÆûË∑µËÆ∞ÂΩïÊ®°ÊÄÅÊ°Ü
        function closePracticeModal() {
            document.getElementById('practiceModal').classList.add('hidden');
            currentActionId = null;
        }
        
        // ËØÑÂàÜÂäüËÉΩ
        function resetRating() {
            document.querySelectorAll('.star').forEach(star => {
                star.classList.remove('active');
            });
            document.getElementById('ratingText').textContent = 'Êú™ËØÑÂàÜ';
        }
        
        // ÂàùÂßãÂåñËØÑÂàÜÂäüËÉΩ
        function initRating() {
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    document.querySelectorAll('.star').forEach((s, index) => {
                        if (index < rating) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                    document.getElementById('ratingText').textContent = `${rating}Êòü`;
                });
            });
        }
        
        // Êèê‰∫§ÂÆûË∑µËÆ∞ÂΩï
        async function submitPracticeLog(event) {
            event.preventDefault();
            
            const formData = {
                date: document.getElementById('practiceDate').value,
                result: document.getElementById('practiceResult').value,
                notes: document.getElementById('practiceNotes').value || null,
                rating: document.querySelectorAll('.star.active').length || null
            };
            
            // ÂØπ‰∫éÊÉÖÂ¢ÉÂûãÔºåÊ∑ªÂä†attempt_numberÂ≠óÊÆµ
            const practiceCount = document.getElementById('practiceCount').value;
            if (practiceCount && document.getElementById('practiceCountGroup').style.display !== 'none') {
                formData.attempt_number = parseInt(practiceCount);
            }
            
            try {
                await apiRequest(`/api/actions/${currentActionId}/practice`, {
                    method: 'POST',
                    body: JSON.stringify(formData)
                });
                
                showMessage('ÂÆûË∑µËÆ∞ÂΩïÂ∑≤‰øùÂ≠òÔºÅ', 'success');
                closePracticeModal();
                loadActions();
                // Â¶ÇÊûúÂΩìÂâçÂú®‰ª™Ë°®ÁõòÈ°µÈù¢ÔºåÂà∑Êñ∞‰ª™Ë°®ÁõòÊï∞ÊçÆ
                if (typeof loadCurrentViewData === 'function') {
                    loadCurrentViewData();
                }
            } catch (error) {
                showMessage('‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
            }
        }
        
        // ÁºñËæëË°åÂä®È°πÁõ∏ÂÖ≥ÂáΩÊï∞
        let currentEditActionId = null;
        
        async function showEditActionModal(actionId) {
            currentEditActionId = actionId;
            
            // Ëé∑ÂèñË°åÂä®È°πËØ¶ÊÉÖ
            try {
                const response = await apiRequest('/api/actions/');
                const action = response.items.find(a => a.id === actionId);
                
                if (!action) {
                    showMessage('Ë°åÂä®È°π‰∏çÂ≠òÂú®', 'error');
                    return;
                }
                
                // Â°´ÂÖÖË°®Âçï
                document.getElementById('editActionText').value = action.action_text;
                document.getElementById('editActionType').value = action.action_type || 'trigger';
                document.getElementById('editActionTags').value = action.tags.join(', ');
                
                // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
                document.getElementById('editActionModal').classList.remove('hidden');
            } catch (error) {
                showMessage('Ëé∑ÂèñË°åÂä®È°πËØ¶ÊÉÖÂ§±Ë¥•: ' + error.message, 'error');
            }
        }
        
        function closeEditActionModal() {
            document.getElementById('editActionModal').classList.add('hidden');
            currentEditActionId = null;
        }
        
        async function submitEditAction(event) {
            event.preventDefault();
            
            const actionText = document.getElementById('editActionText').value.trim();
            const actionType = document.getElementById('editActionType').value;
            const tagsText = document.getElementById('editActionTags').value.trim();
            const tags = tagsText ? tagsText.split(',').map(tag => tag.trim()).filter(tag => tag) : [];
            
            try {
                await apiRequest(`/api/actions/${currentEditActionId}`, {
                    method: 'PUT',
                    body: JSON.stringify({
                        action_text: actionText,
                        action_type: actionType,
                        tags: tags
                    })
                });
                
                showMessage('Ë°åÂä®È°πÂ∑≤Êõ¥Êñ∞ÔºÅ', 'success');
                closeEditActionModal();
                
                // Âà∑Êñ∞Êï∞ÊçÆ
                await loadActions();
                // Â¶ÇÊûúÂΩìÂâçÂú®‰ª™Ë°®ÁõòÈ°µÈù¢ÔºåÂà∑Êñ∞‰ª™Ë°®ÁõòÊï∞ÊçÆ
                if (typeof loadCurrentViewData === 'function') {
                    await loadCurrentViewData();
                }
            } catch (error) {
                showMessage('Êõ¥Êñ∞Â§±Ë¥•: ' + error.message, 'error');
            }
        }
        
        async function deleteAction(actionId) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Ë°åÂä®È°πÂêóÔºüÂà†Èô§ÂêéÂ∞ÜÊó†Ê≥ïÊÅ¢Â§ç„ÄÇ')) {
                return;
            }
            
            try {
                await apiRequest(`/api/actions/${actionId}`, {
                    method: 'DELETE'
                });
                
                showMessage('Ë°åÂä®È°πÂ∑≤Âà†Èô§', 'success');
                loadActions();
                // Â¶ÇÊûúÂΩìÂâçÂú®‰ª™Ë°®ÁõòÈ°µÈù¢ÔºåÂà∑Êñ∞‰ª™Ë°®ÁõòÊï∞ÊçÆ
                if (typeof loadCurrentViewData === 'function') {
                    loadCurrentViewData();
                }
            } catch (error) {
                showMessage('Âà†Èô§Â§±Ë¥•: ' + error.message, 'error');
            }
        }

        function openAIAdvice(actionId) {
            // ÊâìÂºÄÊñ∞Ê†áÁ≠æÈ°µÔºåË∑≥ËΩ¨Âà∞AIÂª∫ËÆÆÈ°µÈù¢
            const url = `/static/ai_advice.html?action_id=${actionId}`;
            window.open(url, '_blank');
        }
        
        // ‰∫ã‰ª∂ÁõëÂê¨
        document.getElementById('uploadForm').addEventListener('submit', (e) => {
            e.preventDefault();
            uploadNotes();
        });
        
        document.getElementById('editActionForm').addEventListener('submit', submitEditAction);
        
        // ÁôªÂΩïË°®Âçï‰∫ã‰ª∂
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showMessage('ËØ∑Â°´ÂÜôÂÆåÊï¥‰ø°ÊÅØ', 'error');
                return;
            }
            
            const btn = e.target.querySelector('.auth-btn');
            btn.disabled = true;
            btn.textContent = 'ÁôªÂΩï‰∏≠...';
            
            await login(email, password);
            
            btn.disabled = false;
            btn.textContent = 'ÁôªÂΩï';
        });
        
        // Ê≥®ÂÜåË°®Âçï‰∫ã‰ª∂
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const name = document.getElementById('registerName').value;
            
            if (!email || !password) {
                showMessage('ËØ∑Â°´ÂÜôÈÇÆÁÆ±ÂíåÂØÜÁ†Å', 'error');
                return;
            }
            
            if (password.length < 6) {
                showMessage('ÂØÜÁ†ÅËá≥Â∞ëÈúÄË¶Å6‰Ωç', 'error');
                return;
            }
            
            const btn = e.target.querySelector('.auth-btn');
            btn.disabled = true;
            btn.textContent = 'Ê≥®ÂÜå‰∏≠...';
            
            await register(email, password, name);
            
            btn.disabled = false;
            btn.textContent = 'Ê≥®ÂÜå';
        });
        
        // Ë∑≥ËΩ¨Âà∞ Self-talk È°µÈù¢
        function goToSelfTalk() {
            if (!authToken) {
                showMessage('ËØ∑ÂÖàÁôªÂΩï', 'error');
                showAuthModal();
                return;
            }
            window.location.href = '/static/self_talk/index.html';
        }
        
        // Ë∑≥ËΩ¨Âà∞Êï∞ÊçÆÂèØËßÜÂåñ‰ª™Ë°®Áõò
        function goToDashboard() {
            if (!authToken) {
                showMessage('ËØ∑ÂÖàÁôªÂΩï', 'error');
                showAuthModal();
                return;
            }
            window.location.href = '/static/dashboard.html';
        }
        
        function goToUserCenter() {
            if (!authToken) {
                showMessage('ËØ∑ÂÖàÁôªÂΩï', 'error');
                showAuthModal();
                return;
            }
            navigateTo('user-center');
        }
        
        // ============= ‰∏™‰∫∫‰∏≠ÂøÉÁõ∏ÂÖ≥ÂáΩÊï∞ =============
        let currentUser = null;
        
        // ÂàùÂßãÂåñ‰∏™‰∫∫‰∏≠ÂøÉ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function initializeUserCenter() {
            // ÊèêÈÜíÂºÄÂÖ≥ËÅîÂä®ÈÄªËæë
            document.getElementById('reminderMasterSwitch').addEventListener('change', updateReminderSwitchStates);
            
            // ÊòµÁß∞ÁºñËæëË°®ÂçïÊèê‰∫§
            document.getElementById('editNameForm').addEventListener('submit', handleEditNameSubmit);
            
            // Êñ∞ÊòµÁß∞ËæìÂÖ•È™åËØÅ
            document.getElementById('newName').addEventListener('input', validateNickname);
        }
        
        // ÊòæÁ§∫‰∏™‰∫∫‰∏≠ÂøÉÂºπÁ™óÔºàÂ∑≤Â∫üÂºÉÔºåÁé∞Âú®‰ΩøÁî®navigateToÔºâ
        async function showUserCenterModal() {
            // ÈáçÂÆöÂêëÂà∞Êñ∞ÁöÑsectionÊñπÂºè
            navigateTo('user-center');
        }
        
        // ÂÖ≥Èó≠‰∏™‰∫∫‰∏≠ÂøÉÂºπÁ™óÔºàÂ∑≤Â∫üÂºÉÔºâ
        function closeUserCenterModal() {
            // ÈáçÂÆöÂêëÂà∞overview
            navigateTo('overview');
        }
        
        // Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØ
        async function loadUserInfo() {
            const token = localStorage.getItem('authToken');
            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    currentUser = await response.json();
                    document.getElementById('userDisplayName').textContent = currentUser.name || 'Êú™ËÆæÁΩÆ';
                    document.getElementById('userDisplayEmail').textContent = currentUser.email;
                    document.getElementById('userDisplayPlan').textContent = currentUser.plan || 'Free';
                } else {
                    throw new Error('Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•:', error);
                showMessage('Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•', 'error');
            }
        }
        
        // Âä†ËΩΩÊèêÈÜíËÆæÁΩÆ
        async function loadReminderSettings() {
            const token = localStorage.getItem('authToken');
            try {
                const response = await fetch(`${API_BASE}/api/self_talk_reminders/settings`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const settings = await response.json();
                    populateReminderSettings(settings);
                } else {
                    // Â¶ÇÊûúËé∑ÂèñÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ËÆæÁΩÆ
                    console.warn('Ëé∑ÂèñÊèêÈÜíËÆæÁΩÆÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ËÆæÁΩÆ');
                    populateReminderSettings({
                        is_enabled: true,
                        daily_reminder_enabled: false,
                        daily_reminder_time: "20:00",
                        reminder_days: [0,1,2,3,4,5,6],
                        after_action_reminder: true,
                        after_new_action_reminder: true,
                        inactive_days_threshold: 3,
                        browser_notification: true,
                        email_notification: true
                    });
                }
            } catch (error) {
                console.error('Âä†ËΩΩÊèêÈÜíËÆæÁΩÆÂ§±Ë¥•:', error);
                // ‰ΩøÁî®ÈªòËÆ§ËÆæÁΩÆ
                populateReminderSettings({
                    is_enabled: true,
                    daily_reminder_enabled: false,
                    daily_reminder_time: "20:00",
                    reminder_days: [0,1,2,3,4,5,6],
                    after_action_reminder: true,
                    after_new_action_reminder: true,
                    inactive_days_threshold: 3,
                    browser_notification: true,
                    email_notification: true
                });
            }
        }
        
        // Â°´ÂÖÖÊèêÈÜíËÆæÁΩÆÂà∞ÁïåÈù¢
        function populateReminderSettings(settings) {
            document.getElementById('reminderMasterSwitch').checked = settings.is_enabled;
            document.getElementById('reminderDailySwitch').checked = settings.daily_reminder_enabled;
            document.getElementById('reminderActionSwitch').checked = settings.after_action_reminder;
            document.getElementById('reminderNewActionSwitch').checked = settings.after_new_action_reminder;
            document.getElementById('reminderBrowserSwitch').checked = settings.browser_notification;
            document.getElementById('reminderEmailSwitch').checked = settings.email_notification;

            // ËÆæÁΩÆÊó∂Èó¥
            if (settings.daily_reminder_time) {
                document.getElementById('dailyReminderTime').value = settings.daily_reminder_time;
            }

            // ËÆæÁΩÆÊó•Êúü
            if (settings.reminder_days) {
                for (let i = 0; i < 7; i++) {
                    document.getElementById(`reminderDay${i}`).checked = settings.reminder_days.includes(i);
                }
            }

            // ËÆæÁΩÆÈùûÊ¥ªË∑ÉÂ§©Êï∞
            if (settings.inactive_days_threshold) {
                document.getElementById('inactiveDaysThreshold').value = settings.inactive_days_threshold;
            }

            // ËÆæÁΩÆËÅîÂä®ÈÄªËæë
            updateReminderSwitchStates();
        }
        
        // Êõ¥Êñ∞ÊèêÈÜíÂºÄÂÖ≥Áä∂ÊÄÅÔºàËÅîÂä®ÈÄªËæëÔºâ
        function updateReminderSwitchStates() {
            const masterSwitch = document.getElementById('reminderMasterSwitch');
            const otherSwitches = [
                document.getElementById('reminderDailySwitch'),
                document.getElementById('reminderActionSwitch'),
                document.getElementById('reminderNewActionSwitch'),
                document.getElementById('reminderBrowserSwitch'),
                document.getElementById('reminderEmailSwitch')
            ];

            otherSwitches.forEach(switchEl => {
                switchEl.disabled = !masterSwitch.checked;
            });
        }
        
        // ‰øùÂ≠òÊèêÈÜíËÆæÁΩÆ
        async function saveReminderSettings() {
            const token = localStorage.getItem('authToken');

            // Êî∂ÈõÜÊó•ÊúüËÆæÁΩÆ
            const reminderDays = [];
            for (let i = 0; i < 7; i++) {
                if (document.getElementById(`reminderDay${i}`).checked) {
                    reminderDays.push(i);
                }
            }

            const settings = {
                is_enabled: document.getElementById('reminderMasterSwitch').checked,
                daily_reminder_enabled: document.getElementById('reminderDailySwitch').checked,
                daily_reminder_time: document.getElementById('dailyReminderTime').value,
                reminder_days: reminderDays,
                after_action_reminder: document.getElementById('reminderActionSwitch').checked,
                after_new_action_reminder: document.getElementById('reminderNewActionSwitch').checked,
                inactive_days_threshold: parseInt(document.getElementById('inactiveDaysThreshold').value),
                browser_notification: document.getElementById('reminderBrowserSwitch').checked,
                email_notification: document.getElementById('reminderEmailSwitch').checked
            };

            try {
                const response = await fetch(`${API_BASE}/api/self_talk_reminders/settings`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });

                if (response.ok) {
                    showMessage('ÊèêÈÜíËÆæÁΩÆ‰øùÂ≠òÊàêÂäüÔºÅ', 'success');
                } else {
                    throw new Error('‰øùÂ≠òÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('‰øùÂ≠òÊèêÈÜíËÆæÁΩÆÂ§±Ë¥•:', error);
                showMessage('‰øùÂ≠òÊèêÈÜíËÆæÁΩÆÂ§±Ë¥•', 'error');
            }
        }
        
        // ÊòæÁ§∫ÁºñËæëÊòµÁß∞Ê®°ÊÄÅÊ°Ü
        function showEditNameModal() {
            if (currentUser) {
                document.getElementById('currentName').value = currentUser.name || '';
                document.getElementById('newName').value = currentUser.name || '';
                document.getElementById('editNameModal').classList.remove('hidden');
            }
        }
        
        // ÂÖ≥Èó≠ÁºñËæëÊòµÁß∞Ê®°ÊÄÅÊ°Ü
        function closeEditNameModal() {
            document.getElementById('editNameModal').classList.add('hidden');
            document.getElementById('editNameForm').reset();
        }
        
        // ÊòæÁ§∫ÈÄÄÂá∫Á°ÆËÆ§ÂØπËØùÊ°Ü
        function confirmLogout() {
            document.getElementById('logoutConfirmModal').classList.remove('hidden');
        }
        
        // ÂÖ≥Èó≠ÈÄÄÂá∫Á°ÆËÆ§ÂØπËØùÊ°Ü
        function closeLogoutConfirmModal() {
            document.getElementById('logoutConfirmModal').classList.add('hidden');
        }
        
        // ÊâßË°åÈÄÄÂá∫ÁôªÂΩï
        function performLogout() {
            // Ê∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®
            localStorage.removeItem('authToken');
            localStorage.removeItem('token');
            
            // ÂÖ≥Èó≠ÊâÄÊúâÊ®°ÊÄÅÊ°Ü
            closeUserCenterModal();
            closeLogoutConfirmModal();
            
            // ÈáçÁΩÆËÆ§ËØÅÁä∂ÊÄÅ
            authToken = null;
            
            // ÊòæÁ§∫ÁôªÂΩïÊ®°ÊÄÅÊ°Ü
            showAuthModal();
            
            showMessage('Â∑≤ÈÄÄÂá∫ÁôªÂΩï', 'success');
        }
        
        // ÊòµÁß∞È™åËØÅ
        function validateNickname(event) {
            const input = event.target;
            const value = input.value;
            const regex = /^[\u4e00-\u9fa5a-zA-Z0-9]*$/; // Âè™ÂÖÅËÆ∏‰∏≠Êñá„ÄÅËã±Êñá„ÄÅÊï∞Â≠ó
            
            if (value.length > 6) {
                input.value = value.substring(0, 6);
                showMessage('ÊòµÁß∞ÊúÄÂ§ö6‰∏™Â≠óÁ¨¶', 'error');
            } else if (value && !regex.test(value)) {
                input.value = value.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
                showMessage('ÊòµÁß∞Âè™ËÉΩÂåÖÂê´‰∏≠Êñá„ÄÅËã±Êñá„ÄÅÊï∞Â≠ó', 'error');
            }
        }
        
        // Â§ÑÁêÜÊòµÁß∞ÁºñËæëË°®ÂçïÊèê‰∫§
        async function handleEditNameSubmit(event) {
            event.preventDefault();
            
            const newName = document.getElementById('newName').value.trim();
            
            if (!newName) {
                showMessage('ÊòµÁß∞‰∏çËÉΩ‰∏∫Á©∫', 'error');
                return;
            }
            
            if (newName.length > 6) {
                showMessage('ÊòµÁß∞ÊúÄÂ§ö6‰∏™Â≠óÁ¨¶', 'error');
                return;
            }
            
            if (newName === currentUser.name) {
                showMessage('ÊòµÁß∞Ê≤°ÊúâÂèòÂåñ', 'info');
                closeEditNameModal();
                return;
            }
            
            const token = localStorage.getItem('authToken');
            
            try {
                const response = await fetch(`${API_BASE}/auth/profile`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: newName })
                });
                
                if (response.ok) {
                    // Êõ¥Êñ∞Êú¨Âú∞Áî®Êà∑‰ø°ÊÅØ
                    currentUser.name = newName;
                    document.getElementById('userDisplayName').textContent = newName;
                    
                    showMessage('ÊòµÁß∞‰øÆÊîπÊàêÂäüÔºÅ', 'success');
                    closeEditNameModal();
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || '‰øÆÊîπÊòµÁß∞Â§±Ë¥•');
                }
            } catch (error) {
                console.error('‰øÆÊîπÊòµÁß∞Â§±Ë¥•:', error);
                showMessage(error.message || '‰øÆÊîπÊòµÁß∞Â§±Ë¥•', 'error');
            }
        }
        
        // Êó∂Èó¥ÁÆ°ÁêÜËÆæÁΩÆÁõ∏ÂÖ≥ÂáΩÊï∞
        let currentActionForTM = null;
        
        // ÊòæÁ§∫Êó∂Èó¥ÁÆ°ÁêÜÊ®°ÊÄÅÊ°Ü
        async function showTimeManagementModal(actionId) {
            console.log('ÊâìÂºÄÊó∂Èó¥ÁÆ°ÁêÜÊ®°ÊÄÅÊ°ÜÔºåË°åÂä®È°πID:', actionId);
            currentActionForTM = actionId;
            document.getElementById('timeManagementModal').classList.remove('hidden');
            
            try {
                // Ëé∑ÂèñÂΩìÂâçË°åÂä®È°πÊï∞ÊçÆ
                const response = await apiRequest('/api/actions/');
                const action = response.items.find(a => a.id === actionId);
                
                if (action) {
                    // Â°´ÂÖÖÁé∞ÊúâÊï∞ÊçÆ
                    document.getElementById('tmDurationType').value = action.duration_type || 'short_term';
                    document.getElementById('tmTargetDurationDays').value = action.target_duration_days || '';
                    document.getElementById('tmTargetFrequency').value = action.target_frequency || 'daily';
                    document.getElementById('tmCustomFrequencyDays').value = action.custom_frequency_days || '';
                    document.getElementById('tmStartDate').value = action.start_date || new Date().toISOString().split('T')[0];
                    document.getElementById('tmEndDate').value = action.end_date || '';
                } else {
                    // ËÆæÁΩÆÈªòËÆ§ÂÄº
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('tmStartDate').value = today;
                    document.getElementById('tmDurationType').value = 'short_term';
                    document.getElementById('tmTargetDurationDays').value = 30;
                    document.getElementById('tmTargetFrequency').value = 'daily';
                }
                
                // ÂàùÂßãÂåñËÆæÁΩÆ
                toggleTMDurationSettings();
                toggleTMCustomFrequency();
            } catch (error) {
                console.error('Âä†ËΩΩË°åÂä®È°πÊï∞ÊçÆÂ§±Ë¥•:', error);
                // ËÆæÁΩÆÈªòËÆ§ÂÄº
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('tmStartDate').value = today;
                document.getElementById('tmDurationType').value = 'short_term';
                document.getElementById('tmTargetDurationDays').value = 30;
                document.getElementById('tmTargetFrequency').value = 'daily';
                toggleTMDurationSettings();
                toggleTMCustomFrequency();
            }
        }
        
        // ÂÖ≥Èó≠Êó∂Èó¥ÁÆ°ÁêÜÊ®°ÊÄÅÊ°Ü
        function closeTimeManagementModal() {
            document.getElementById('timeManagementModal').classList.add('hidden');
            currentActionForTM = null;
        }
        
        function toggleTMDurationSettings() {
            const durationType = document.getElementById('tmDurationType').value;
            const durationDaysGroup = document.getElementById('tmDurationDaysGroup');
            const endDateGroup = document.getElementById('tmEndDateGroup');
            const endDate = document.getElementById('tmEndDate');
            
            if (durationType === 'lifetime') {
                // ÁªàË∫´‰π†ÊÉØÔºöÈöêËóèÂ§©Êï∞ËÆæÁΩÆÂíåÁªìÊùüÊó•Êúü
                durationDaysGroup.style.display = 'none';
                endDateGroup.style.display = 'none';
                endDate.value = '';
            } else {
                // Áü≠Êúü/ÈïøÊúüÁõÆÊ†áÔºöÊòæÁ§∫Â§©Êï∞ËÆæÁΩÆÂíåÁªìÊùüÊó•Êúü
                durationDaysGroup.style.display = 'block';
                endDateGroup.style.display = 'block';
                
                // Ê†πÊçÆÁ±ªÂûãËÆæÁΩÆÈªòËÆ§Â§©Êï∞
                if (durationType === 'short_term') {
                    document.getElementById('tmTargetDurationDays').value = 30;
                } else if (durationType === 'long_term') {
                    document.getElementById('tmTargetDurationDays').value = 365;
                }
                
                // ËÆæÁΩÆÁªìÊùüÊó•Êúü
                const days = document.getElementById('tmTargetDurationDays').value || 30;
                const startDate = new Date(document.getElementById('tmStartDate').value || new Date());
                const endDate = new Date(startDate);
                endDate.setDate(endDate.getDate() + parseInt(days));
                document.getElementById('tmEndDate').value = endDate.toISOString().split('T')[0];
            }
        }
        
        function toggleTMCustomFrequency() {
            const frequency = document.getElementById('tmTargetFrequency').value;
            const customFrequencyGroup = document.getElementById('tmCustomFrequencyGroup');
            
            if (frequency === 'custom') {
                customFrequencyGroup.style.display = 'block';
            } else {
                customFrequencyGroup.style.display = 'none';
            }
        }
        
        // ÊÉÖÂ¢ÉÂûãÊ¨°Êï∞ÂíåÂ§©Êï∞ËÆæÁΩÆÁõ∏ÂÖ≥ÂáΩÊï∞
        let currentActionForCD = null;
        
        function showCountAndDaysModal(actionId) {
            currentActionForCD = actionId;
            document.getElementById('countAndDaysModal').classList.remove('hidden');
            
            // ËÆæÁΩÆÈªòËÆ§Êó•Êúü
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('cdStartDate').value = today;
            
            // Âä†ËΩΩÁé∞ÊúâÊï∞ÊçÆ
            loadCountAndDaysData(actionId);
        }
        
        function closeCountAndDaysModal() {
            document.getElementById('countAndDaysModal').classList.add('hidden');
            currentActionForCD = null;
        }
        
        async function loadCountAndDaysData(actionId) {
            try {
                const response = await apiRequest('/api/actions/');
                const action = response.items.find(a => a.id === actionId);
                
                if (action) {
                    // ÂØπ‰∫éÊÉÖÂ¢ÉÂûãÔºå‰ΩøÁî®target_duration_days‰Ωú‰∏∫ÁõÆÊ†áÊ¨°Êï∞Ôºåcustom_frequency_days‰Ωú‰∏∫ÂÆåÊàêÂ§©Êï∞
                    document.getElementById('cdTargetCount').value = action.target_duration_days || '';
                    document.getElementById('cdTargetDays').value = action.custom_frequency_days || '';
                    document.getElementById('cdStartDate').value = action.start_date || new Date().toISOString().split('T')[0];
                    document.getElementById('cdEndDate').value = action.end_date || '';
                }
            } catch (error) {
                console.error('Âä†ËΩΩÊ¨°Êï∞ÂíåÂ§©Êï∞Êï∞ÊçÆÂ§±Ë¥•:', error);
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('cdStartDate').value = today;
            }
        }
        
        async function submitCountAndDays(event) {
            event.preventDefault();
            
            if (!currentActionForCD) {
                showMessage('Êú™ÈÄâÊã©Ë°åÂä®È°π', 'error');
                return;
            }
            
            const targetCount = document.getElementById('cdTargetCount').value ? parseInt(document.getElementById('cdTargetCount').value) : null;
            const targetDays = document.getElementById('cdTargetDays').value ? parseInt(document.getElementById('cdTargetDays').value) : null;
            const startDate = document.getElementById('cdStartDate').value || null;
            const endDate = document.getElementById('cdEndDate').value || null;
            
            // È™åËØÅËÆæÁΩÆ
            if (!targetCount || !targetDays) {
                showMessage('ËØ∑Â°´ÂÜôÁõÆÊ†áÊ¨°Êï∞ÂíåÂÆåÊàêÂ§©Êï∞', 'error');
                return;
            }
            
            const requestData = {
                duration_type: "short_term",  // ÊÉÖÂ¢ÉÂûãÂõ∫ÂÆö‰∏∫Áü≠Êúü
                target_duration_days: targetCount,  // Â≠òÂÇ®ÁõÆÊ†áÊ¨°Êï∞
                target_frequency: "custom",
                custom_frequency_days: targetDays,  // Â≠òÂÇ®ÂÆåÊàêÂ§©Êï∞
                start_date: startDate,
                end_date: endDate
            };
            
            try {
                const response = await apiRequest(`/api/actions/${currentActionForCD}`, {
                    method: 'PUT',
                    body: JSON.stringify(requestData)
                });
                
                showMessage('Ê¨°Êï∞ÂíåÂ§©Êï∞ËÆæÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                closeCountAndDaysModal();
                
                // Âà∑Êñ∞Ë°åÂä®È°πÂàóË°®
                loadActions();
                // Â¶ÇÊûúÂΩìÂâçÂú®‰ª™Ë°®ÁõòÈ°µÈù¢ÔºåÂà∑Êñ∞‰ª™Ë°®ÁõòÊï∞ÊçÆ
                if (typeof loadCurrentViewData === 'function') {
                    loadCurrentViewData();
                }
            } catch (error) {
                showMessage('‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
            }
        }
        
        // ÊâπÈáèÊó∂Èó¥ÁÆ°ÁêÜËÆæÁΩÆÁõ∏ÂÖ≥ÂáΩÊï∞
        function showBatchTimeManagementModal() {
            document.getElementById('batchTimeManagementModal').classList.remove('hidden');
            
            // ËÆæÁΩÆÈªòËÆ§Êó•Êúü
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('btmStartDate').value = today;
            
            // ÂàùÂßãÂåñËÆæÁΩÆ
            toggleBTMDurationSettings();
        }
        
        function closeBatchTimeManagementModal() {
            document.getElementById('batchTimeManagementModal').classList.add('hidden');
        }
        
        function toggleBTMDurationSettings() {
            const durationType = document.getElementById('btmDurationType').value;
            const durationDaysGroup = document.getElementById('btmDurationDaysGroup');
            const endDateGroup = document.getElementById('btmEndDateGroup');
            const endDate = document.getElementById('btmEndDate');
            
            if (durationType === 'lifetime') {
                // ÁªàË∫´‰π†ÊÉØÔºöÈöêËóèÂ§©Êï∞ËÆæÁΩÆÂíåÁªìÊùüÊó•Êúü
                durationDaysGroup.style.display = 'none';
                endDateGroup.style.display = 'none';
                endDate.value = '';
            } else {
                // Áü≠Êúü/ÈïøÊúüÁõÆÊ†áÔºöÊòæÁ§∫Â§©Êï∞ËÆæÁΩÆÂíåÁªìÊùüÊó•Êúü
                durationDaysGroup.style.display = 'block';
                endDateGroup.style.display = 'block';
                
                // Ê†πÊçÆÁ±ªÂûãËÆæÁΩÆÈªòËÆ§Â§©Êï∞
                if (durationType === 'short_term') {
                    document.getElementById('btmTargetDurationDays').value = 30;
                } else if (durationType === 'long_term') {
                    document.getElementById('btmTargetDurationDays').value = 365;
                }
                
                // ËÆæÁΩÆÁªìÊùüÊó•Êúü
                const days = document.getElementById('btmTargetDurationDays').value || 30;
                const startDate = new Date(document.getElementById('btmStartDate').value || new Date());
                const endDate = new Date(startDate);
                endDate.setDate(endDate.getDate() + parseInt(days));
                document.getElementById('btmEndDate').value = endDate.toISOString().split('T')[0];
            }
        }
        
        function toggleBTMCustomFrequency() {
            const frequency = document.getElementById('btmTargetFrequency').value;
            const customFrequencyGroup = document.getElementById('btmCustomFrequencyGroup');
            
            if (frequency === 'custom') {
                customFrequencyGroup.style.display = 'block';
            } else {
                customFrequencyGroup.style.display = 'none';
            }
        }
        
        // Êèê‰∫§Êó∂Èó¥ÁÆ°ÁêÜËÆæÁΩÆ
        async function submitTimeManagement(event) {
            event.preventDefault();
            console.log('ÂºÄÂßãÊèê‰∫§Êó∂Èó¥ÁÆ°ÁêÜËÆæÁΩÆÔºåË°åÂä®È°πID:', currentActionForTM);
            
            if (!currentActionForTM) {
                showMessage('Êú™ÈÄâÊã©Ë°åÂä®È°π', 'error');
                return;
            }
            
            const durationType = document.getElementById('tmDurationType').value;
            const targetDurationDays = document.getElementById('tmTargetDurationDays').value ? parseInt(document.getElementById('tmTargetDurationDays').value) : null;
            const targetFrequency = document.getElementById('tmTargetFrequency').value;
            const customFrequencyDays = document.getElementById('tmCustomFrequencyDays').value ? parseInt(document.getElementById('tmCustomFrequencyDays').value) : null;
            const startDate = document.getElementById('tmStartDate').value || null;
            const endDate = document.getElementById('tmEndDate').value || null;
            
            // È™åËØÅËÆæÁΩÆ
            if (durationType === 'lifetime' && endDate) {
                showMessage('ÁªàË∫´‰π†ÊÉØ‰∏çÈúÄË¶ÅËÆæÁΩÆÁªìÊùüÊó•Êúü', 'error');
                return;
            }
            
            if (targetFrequency === 'custom' && !customFrequencyDays) {
                showMessage('Ëá™ÂÆö‰πâÈ¢ëÁéáÈúÄË¶ÅÊåáÂÆöÂ§©Êï∞', 'error');
                return;
            }
            
            const requestData = {
                duration_type: durationType,
                target_duration_days: targetDurationDays,
                target_frequency: targetFrequency,
                custom_frequency_days: customFrequencyDays,
                start_date: startDate,
                end_date: endDate
            };
            
            console.log('Êèê‰∫§ÁöÑÊï∞ÊçÆ:', requestData);
            console.log('ËØ∑Ê±ÇURL:', `/api/actions/${currentActionForTM}`);
            
            try {
                const response = await apiRequest(`/api/actions/${currentActionForTM}`, {
                    method: 'PUT',
                    body: JSON.stringify(requestData)
                });
                
                console.log('‰øùÂ≠òÊàêÂäüÔºåÂìçÂ∫î:', response);
                
                showMessage('Êó∂Èó¥ÁÆ°ÁêÜËÆæÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                closeTimeManagementModal();
                
                // Âà∑Êñ∞Ë°åÂä®È°πÂàóË°®
                loadActions();
                // Â¶ÇÊûúÂΩìÂâçÂú®‰ª™Ë°®ÁõòÈ°µÈù¢ÔºåÂà∑Êñ∞‰ª™Ë°®ÁõòÊï∞ÊçÆ
                if (typeof loadCurrentViewData === 'function') {
                    loadCurrentViewData();
                }
            } catch (error) {
                showMessage('‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
            }
        }
        
        // Êèê‰∫§ÊâπÈáèÊó∂Èó¥ÁÆ°ÁêÜËÆæÁΩÆÔºà‰ªÖÂØπ‰π†ÊÉØÂûãÔºâ
        async function submitBatchTimeManagement(event) {
            event.preventDefault();
            
            const durationType = document.getElementById('btmDurationType').value;
            const targetDurationDays = document.getElementById('btmTargetDurationDays').value ? parseInt(document.getElementById('btmTargetDurationDays').value) : null;
            const targetFrequency = document.getElementById('btmTargetFrequency').value;
            const customFrequencyDays = document.getElementById('btmCustomFrequencyDays').value ? parseInt(document.getElementById('btmCustomFrequencyDays').value) : null;
            const startDate = document.getElementById('btmStartDate').value || null;
            const endDate = document.getElementById('btmEndDate').value || null;
            
            // È™åËØÅËÆæÁΩÆ
            if (durationType === 'lifetime' && endDate) {
                showMessage('ÁªàË∫´‰π†ÊÉØ‰∏çÈúÄË¶ÅËÆæÁΩÆÁªìÊùüÊó•Êúü', 'error');
                return;
            }
            
            if (targetFrequency === 'custom' && !customFrequencyDays) {
                showMessage('Ëá™ÂÆö‰πâÈ¢ëÁéáÈúÄË¶ÅÊåáÂÆöÂ§©Êï∞', 'error');
                return;
            }
            
            try {
                // Ëé∑ÂèñÊâÄÊúâÊú™ÂÆåÊàêÁöÑ‰π†ÊÉØÂûãË°åÂä®È°π
                const response = await apiRequest('/api/actions/');
                const incompleteHabitActions = response.items.filter(action => 
                    action.status !== 'done' && action.action_type === 'habit'
                );
                
                if (incompleteHabitActions.length === 0) {
                    showMessage('Ê≤°ÊúâÊú™ÂÆåÊàêÁöÑ‰π†ÊÉØÂûãË°åÂä®È°πÈúÄË¶ÅËÆæÁΩÆ', 'info');
                    closeBatchTimeManagementModal();
                    return;
                }
                
                // ÊâπÈáèÊõ¥Êñ∞ÊâÄÊúâÊú™ÂÆåÊàêÁöÑ‰π†ÊÉØÂûãË°åÂä®È°π
                const updatePromises = incompleteHabitActions.map(action => 
                    apiRequest(`/api/actions/${action.id}`, {
                        method: 'PUT',
                        body: JSON.stringify({
                            duration_type: durationType,
                            target_duration_days: targetDurationDays,
                            target_frequency: targetFrequency,
                            custom_frequency_days: customFrequencyDays,
                            start_date: startDate,
                            end_date: endDate
                        })
                    })
                );
                
                await Promise.all(updatePromises);
                
                showMessage(`Â∑≤‰∏∫ ${incompleteHabitActions.length} ‰∏™‰π†ÊÉØÂûãË°åÂä®È°πÂ∫îÁî®Êó∂Èó¥ÁÆ°ÁêÜËÆæÁΩÆ`, 'success');
                closeBatchTimeManagementModal();
                
                // Âà∑Êñ∞Ë°åÂä®È°πÂàóË°®
                loadActions();
                // Â¶ÇÊûúÂΩìÂâçÂú®‰ª™Ë°®ÁõòÈ°µÈù¢ÔºåÂà∑Êñ∞‰ª™Ë°®ÁõòÊï∞ÊçÆ
                if (typeof loadCurrentViewData === 'function') {
                    loadCurrentViewData();
                }
            } catch (error) {
                showMessage('ÊâπÈáèËÆæÁΩÆÂ§±Ë¥•: ' + error.message, 'error');
            }
        }
        
        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        window.addEventListener('load', async () => {
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅÔºåÈÅøÂÖçÁôªÂΩïÊ°ÜÈó™ÁÉÅ
            const authModal = document.getElementById('authModal');
            if (authModal) {
                authModal.style.display = 'none';
            }
            
            await checkAuth();
            initRating();
            
            // Âä†ËΩΩ‰ª™Ë°®ÁõòÊï∞ÊçÆ
            await loadDurationAnalytics();
            await loadStreakAnalytics();
            
            // Ë°®Âçï‰∫ã‰ª∂
            document.getElementById('practiceForm').addEventListener('submit', submitPracticeLog);
            document.getElementById('timeManagementForm').addEventListener('submit', submitTimeManagement);
            document.getElementById('countAndDaysForm').addEventListener('submit', submitCountAndDays);
            document.getElementById('batchTimeManagementForm').addEventListener('submit', submitBatchTimeManagement);
        });
    </script>
    
    <!-- Self-talk ÊèêÈÜíÈÄöÁü•ÊúçÂä° -->
    <script src="/static/reminder_notification.js"></script>
</body>
</html>
